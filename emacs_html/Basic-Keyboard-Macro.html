<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- 这是 GNU Emacs 手册,
为 Emacs  29.2 更新

英文原版版权提示 - Original English version copyright note

Copyright © 1985-2024 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "The GNU Manifesto," "Distribution" and
"GNU GENERAL PUBLIC LICENSE," with the Front-Cover Texts being "A GNU
Manual," and with the Back-Cover Texts as in (a) below.  A copy of the
license is included in the section entitled "GNU Free Documentation
License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom."

中文翻译版版权提示 - Chinese translation revision copyright notice

版权所有 © 1985-2024 林羿轩(Ralph Lin).

您有在 Free Software Foundation发布的GNU Free Documentation License 第1.3版或之后版本的约束下对其进行再发布及修的权利。 恒定章节为 "The GNU Manifesto," "分发" "(中文版)GNU GENERAL PUBLIC LICENSE" 和
"GNU GENERAL PUBLIC LICENSE" , 前封面文字为 "A GNU
Manual,"后封面文字如下(a).  本书的FDL许可证可以在 "GNU Free Documentation
License."找到.

(a) FSF的后封面文字为: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom."
 -->
<title>Basic Keyboard Macro (GNU Emacs Manual)</title>

<meta name="description" content="Basic Keyboard Macro (GNU Emacs Manual)">
<meta name="keywords" content="Basic Keyboard Macro (GNU Emacs Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Key-Index.html" rel="index" title="Key Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Keyboard-Macros.html" rel="up" title="Keyboard Macros">
<link href="Keyboard-Macro-Ring.html" rel="next" title="Keyboard Macro Ring">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
kbd.kbd {font-style: oblique}
kbd.key {font-style: normal}
span:hover a.copiable-link {visibility: visible}
-->
</style>


</head>

<body lang="zh_CN">
<div class="section-level-extent" id="Basic-Keyboard-Macro">
<div class="nav-panel">
<p>
Next: <a href="Keyboard-Macro-Ring.html" accesskey="n" rel="next">The Keyboard Macro Ring</a>, Up: <a href="Keyboard-Macros.html" accesskey="u" rel="up">Keyboard Macros</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Key-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="Basic-Use"><span>18.1 Basic Use<a class="copiable-link" href="#Basic-Use"> &para;</a></span></h3>

<dl class="table">
<dt><kbd class="kbd"><kbd class="key">F3</kbd></kbd></dt>
<dd><p>Start defining a keyboard macro
(<code class="code">kmacro-start-macro-or-insert-counter</code>).
</p></dd>
<dt><kbd class="kbd"><kbd class="key">F4</kbd></kbd></dt>
<dd><p>If a keyboard macro is being defined, end the definition; otherwise,
execute the most recent keyboard macro
(<code class="code">kmacro-end-or-call-macro</code>).
</p></dd>
<dt><kbd class="kbd">C-u <kbd class="key">F3</kbd></kbd></dt>
<dd><p>Re-execute last keyboard macro, then append keys to its definition.
</p></dd>
<dt><kbd class="kbd">C-u C-u <kbd class="key">F3</kbd></kbd></dt>
<dd><p>Append keys to the last keyboard macro without re-executing it.
</p></dd>
<dt><kbd class="kbd">C-x C-k r</kbd></dt>
<dd><p>Run the last keyboard macro on each line that begins in the region
(<code class="code">apply-macro-to-region-lines</code>).
</p></dd>
<dt><kbd class="kbd">C-x (</kbd></dt>
<dd><p>Start defining a keyboard macro (old style)
(<code class="code">kmacro-start-macro</code>); with a prefix argument, append keys to
the last macro.
</p></dd>
<dt><kbd class="kbd">C-x )</kbd></dt>
<dd><p>End a macro definition (old style) (<code class="code">kmacro-end-macro</code>); prefix
argument serves as the repeat count for executing the macro.
</p></dd>
<dt><kbd class="kbd">C-x e</kbd></dt>
<dd><p>Execute the most recently defined keyboard macro
(<code class="code">kmacro-end-and-call-macro</code>); prefix argument serves as repeat
count.
</p></dd>
</dl>

<a class="index-entry-id" id="index-F3"></a>
<a class="index-entry-id" id="index-F4"></a>
<a class="index-entry-id" id="index-kmacro_002dstart_002dmacro_002dor_002dinsert_002dcounter"></a>
<a class="index-entry-id" id="index-kmacro_002dend_002dor_002dcall_002dmacro"></a>
<a class="index-entry-id" id="index-kmacro_002dend_002dand_002dcall_002dmacro"></a>
<p>To start defining a keyboard macro, type <kbd class="key">F3</kbd>.  From then on,
your keys continue to be executed, but also become part of the
definition of the macro.  &lsquo;<samp class="samp">Def</samp>&rsquo; appears in the mode line to
remind you of what is going on.  When you are finished, type <kbd class="key">F4</kbd>
(<code class="code">kmacro-end-or-call-macro</code>) to terminate the definition.  For
example,
</p>
<div class="example">
<pre class="example-preformatted"><kbd class="key">F3</kbd> M-f foo <kbd class="key">F4</kbd>
</pre></div>

<p>defines a macro to move forward a word and then insert &lsquo;<samp class="samp">foo</samp>&rsquo;.
Note that <kbd class="key">F3</kbd> and <kbd class="key">F4</kbd> do not become part of the macro.
</p>
<p>After defining the macro, you can call it with <kbd class="key">F4</kbd>.  For the
above example, this has the same effect as typing <kbd class="kbd">M-f foo</kbd> again.
(Note the two roles of the <kbd class="key">F4</kbd> command: it ends the macro if you
are in the process of defining one, or calls the last macro
otherwise.)  You can also supply <kbd class="key">F4</kbd> with a numeric prefix
argument &lsquo;<samp class="samp">n</samp>&rsquo;, which means to invoke the macro &lsquo;<samp class="samp">n</samp>&rsquo; times.  An
argument of zero repeats the macro indefinitely, until it gets an
error or you type <kbd class="kbd">C-g</kbd> (or, on MS-DOS, <kbd class="kbd">C-<kbd class="key">Break</kbd></kbd>).
</p>
<p>The above example demonstrates a handy trick that you can employ
with keyboard macros: if you wish to repeat an operation at regularly
spaced places in the text, include a motion command as part of the
macro.  In this case, repeating the macro inserts the string
&lsquo;<samp class="samp">foo</samp>&rsquo; after each successive word.
</p>
<p>After terminating the definition of a keyboard macro, you can append
more keystrokes to its definition by typing <kbd class="kbd">C-u <kbd class="key">F3</kbd></kbd>.  This
is equivalent to plain <kbd class="key">F3</kbd> followed by retyping the whole
definition so far.  As a consequence, it re-executes the macro as
previously defined.  If you change the variable
<code class="code">kmacro-execute-before-append</code> to <code class="code">nil</code>, the existing macro
will not be re-executed before appending to it (the default is
<code class="code">t</code>).  You can also add to the end of the definition of the last
keyboard macro without re-executing it by typing <kbd class="kbd">C-u C-u
<kbd class="key">F3</kbd></kbd>.
</p>
<p>When a command reads an argument with the minibuffer, your
minibuffer input becomes part of the macro along with the command.  So
when you replay the macro, the command gets the same argument as when
you entered the macro.  For example,
</p>
<div class="example">
<pre class="example-preformatted"><kbd class="key">F3</kbd> C-a C-k C-x b foo <kbd class="key">RET</kbd> C-y C-x b <kbd class="key">RET</kbd> <kbd class="key">F4</kbd>
</pre></div>

<p>defines a macro that kills the current line, yanks it into the buffer
&lsquo;<samp class="samp">foo</samp>&rsquo;, then returns to the original buffer.
</p>
<p>Most keyboard commands work as usual in a keyboard macro definition,
with some exceptions.  Typing <kbd class="kbd">C-g</kbd> (<code class="code">keyboard-quit</code>) quits
the keyboard macro definition.  Typing <kbd class="kbd">C-M-c</kbd>
(<code class="code">exit-recursive-edit</code>) can be unreliable: it works as you&rsquo;d
expect if exiting a recursive edit that started within the macro, but
if it exits a recursive edit that started before you invoked the
keyboard macro, it also necessarily exits the keyboard macro too.
Mouse events are also unreliable, even though you can use them in a
keyboard macro: when the macro replays the mouse event, it uses the
original mouse position of that event, the position that the mouse had
while you were defining the macro.  The effect of this may be hard to
predict.
</p>
<a class="index-entry-id" id="index-apply_002dmacro_002dto_002dregion_002dlines"></a>
<a class="index-entry-id" id="index-C_002dx-C_002dk-r"></a>
<p>The command <kbd class="kbd">C-x C-k r</kbd> (<code class="code">apply-macro-to-region-lines</code>)
repeats the last defined keyboard macro on each line that begins in
the region.  It does this line by line, by moving point to the
beginning of the line and then executing the macro.
</p>
<a class="index-entry-id" id="index-C_002dx-_0028"></a>
<a class="index-entry-id" id="index-C_002dx-_0029"></a>
<a class="index-entry-id" id="index-C_002dx-e"></a>
<a class="index-entry-id" id="index-kmacro_002dstart_002dmacro"></a>
<a class="index-entry-id" id="index-kmacro_002dend_002dmacro"></a>
<p>In addition to the <kbd class="key">F3</kbd> and <kbd class="key">F4</kbd> commands described above,
Emacs also supports an older set of key bindings for defining and
executing keyboard macros.  To begin a macro definition, type <kbd class="kbd">C-x
(</kbd> (<code class="code">kmacro-start-macro</code>); as with <kbd class="key">F3</kbd>, a prefix argument
appends this definition to the last keyboard macro.  To end a macro
definition, type <kbd class="kbd">C-x )</kbd> (<code class="code">kmacro-end-macro</code>).  To execute
the most recent macro, type <kbd class="kbd">C-x e</kbd>
(<code class="code">kmacro-end-and-call-macro</code>).  If you enter <kbd class="kbd">C-x e</kbd> while
defining a macro, the macro is terminated and executed immediately.
Immediately after typing <kbd class="kbd">C-x e</kbd>, you can type <kbd class="kbd">e</kbd> repeatedly
to immediately repeat the macro one or more times.  You can also give
<kbd class="kbd">C-x e</kbd> a repeat argument, just like <kbd class="key">F4</kbd> (when it is used to
execute a macro).
</p>
<p><kbd class="kbd">C-x )</kbd> can be given a repeat count as an argument.  This means
to repeat the macro right after defining it.  The macro definition
itself counts as the first repetition, since it is executed as you
define it, so <kbd class="kbd">C-u 4 C-x )</kbd> executes the macro immediately 3
additional times.
</p>
<a class="index-entry-id" id="index-kmacro_002dredisplay"></a>
<a class="index-entry-id" id="index-C_002dx-C_002dk-d"></a>
<p>While executing a long-running keyboard macro, it can sometimes be
useful to trigger a redisplay (to show how far we&rsquo;ve gotten).  The
<kbd class="kbd">C-x C-k d</kbd> command can be used for this.  As a not very useful
example, <kbd class="kbd">C-x ( M-f C-x C-k d C-x )</kbd> will create a macro that will
redisplay once per iteration when saying <kbd class="kbd">C-u 42 C-x e</kbd>.
</p>
</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Keyboard-Macro-Ring.html">The Keyboard Macro Ring</a>, Up: <a href="Keyboard-Macros.html">Keyboard Macros</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Key-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
