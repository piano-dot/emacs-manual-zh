<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- 这是 GNU Emacs 手册,
为 Emacs  29.2 更新

英文原版版权提示 - Original English version copyright note

Copyright © 1985-2024 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "The GNU Manifesto," "Distribution" and
"GNU GENERAL PUBLIC LICENSE," with the Front-Cover Texts being "A GNU
Manual," and with the Back-Cover Texts as in (a) below.  A copy of the
license is included in the section entitled "GNU Free Documentation
License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom."

中文翻译版版权提示 - Chinese translation revision copyright notice

版权所有 © 1985-2024 林羿轩(Ralph Lin).

您有在 Free Software Foundation发布的GNU Free Documentation License 第1.3版或之后版本的约束下对其进行再发布及修的权利。 恒定章节为 "The GNU Manifesto," "分发" "(中文版)GNU GENERAL PUBLIC LICENSE" 和
"GNU GENERAL PUBLIC LICENSE" , 前封面文字为 "A GNU
Manual,"后封面文字如下(a).  本书的FDL许可证可以在 "GNU Free Documentation
License."找到.

(a) FSF的后封面文字为: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom."
 -->
<title>Code Alignment (GNU Emacs Manual)</title>

<meta name="description" content="Code Alignment (GNU Emacs Manual)">
<meta name="keywords" content="Code Alignment (GNU Emacs Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Key-Index.html" rel="index" title="Key Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Indentation.html" rel="up" title="Indentation">
<link href="Indent-Convenience.html" rel="prev" title="Indent Convenience">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
kbd.kbd {font-style: oblique}
kbd.key {font-style: normal}
span:hover a.copiable-link {visibility: visible}
-->
</style>


</head>

<body lang="zh_CN">
<div class="section-level-extent" id="Code-Alignment">
<div class="nav-panel">
<p>
Previous: <a href="Indent-Convenience.html" accesskey="p" rel="prev">Convenience Features for Indentation</a>, Up: <a href="Indentation.html" accesskey="u" rel="up">Indentation</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Key-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="Code-Alignment-1"><span>25.5 Code Alignment<a class="copiable-link" href="#Code-Alignment-1"> &para;</a></span></h3>
<a class="index-entry-id" id="index-code-alignment"></a>
<a class="index-entry-id" id="index-aligning-code"></a>

<p><em class="dfn">Alignment</em> is the process of adjusting whitespace in a sequence
of lines in the region such that in all lines certain parts begin at
the same column.  This is usually something you do to enhance
readability of a piece of text or code.  The classic example is
aligning a series of assignments in C-like programming languages:
</p>
<div class="example">
<pre class="example-preformatted">int a = 1;
short foo = 2;
double blah = 4;
</pre></div>

<p>is commonly aligned to:
</p>
<div class="example">
<pre class="example-preformatted">int    a    = 1;
short  foo  = 2;
double blah = 4;
</pre></div>

<a class="index-entry-id" id="index-alignment-rules"></a>
<a class="index-entry-id" id="index-align"></a>
<p>You can use the command <kbd class="kbd">M-x align</kbd> to align lines in the
current region.  This command knows about common alignment patterns
across many markup and programming languages.  It encodes these
patterns as a set of <em class="dfn">alignment rules</em>, that say how to align
different kinds of text in different contexts.
</p>
<a class="index-entry-id" id="index-align_002drules_002dlist"></a>
<a class="index-entry-id" id="index-align_002dmode_002drules_002dlist"></a>
<p>The user option <code class="code">align-rules-list</code> says which alignment rules
<kbd class="kbd">M-x align</kbd> should consult.  The value of this option is a list
with elements describing alignment rules.  Each element is a cons cell
<code class="code">(<var class="var">title</var> . <var class="var">attributes</var>)</code>, where <var class="var">title</var> is the name
of the alignment rule as a symbol, and <var class="var">attributes</var> is a list of
rule attributes that define when the rule should apply and how it
partitions and aligns lines.  Each rule attribute is a cons cell
<code class="code">(<var class="var">attribute</var> . <var class="var">value</var>)</code>, where <var class="var">attribute</var> is the
name of attribute and <var class="var">value</var> is its value.  The only required
attribute is <code class="code">regexp</code>, whose value is a regular expression with
sub-expressions matching the parts of each line where <kbd class="kbd">M-x align</kbd>
should expand or contract whitespace (see <a class="pxref" href="Regexp-Backslash.html">Backslash in Regular Expressions</a>).  See
the documentation string of <code class="code">align-rules-list</code> (<kbd class="kbd">C-h v
align-rules-list <kbd class="key">RET</kbd></kbd>) for a full description of possible
alignment rule attributes.  By default, this option is set to a long
list of alignment rules for many languages that Emacs supports.  The
default rules use the <code class="code">modes</code> rule attribute to specify major
modes in which <kbd class="kbd">M-x align</kbd> should apply them.  Major modes can
also override <code class="code">align-rules-list</code> by setting the buffer-local
variable <code class="code">align-mode-rules-list</code> to a non-<code class="code">nil</code> list of
alignment rules.  When <code class="code">align-mode-rules-list</code> is non-<code class="code">nil</code>,
<kbd class="kbd">M-x align</kbd> consults it instead of <code class="code">align-rules-list</code>.
</p>
<a class="index-entry-id" id="index-align-exclusion-rules"></a>
<a class="index-entry-id" id="index-align_002dexclude_002drules_002dlist"></a>
<a class="index-entry-id" id="index-align_002dmode_002dexclude_002drules_002dlist"></a>
<p>Besides alignment rules, <kbd class="kbd">M-x align</kbd> uses another kind of rules
called <em class="dfn">exclusion rules</em>.  The exclusion rules say which parts in
the region <kbd class="kbd">M-x align</kbd> should not align and instead leave them
intact.  The user option <code class="code">align-exclude-rules-list</code> specifies
these exclusion rules.  Similarly to <code class="code">align-rules-list</code>, the
value of <code class="code">align-exclude-rules-list</code> is also a list of cons cells
that describe the exclusion rules.  By default,
<code class="code">align-exclude-rules-list</code> includes rules that exclude alignment
in quoted strings and comments in Lisp, C and other languages.  Beyond
the default exclusion rules in <code class="code">align-exclude-rules-list</code>, major
modes can define bespoke exclusion rules by setting
<code class="code">align-mode-exclude-rules-list</code> to a non-<code class="code">nil</code> list of
rules, this overrides <code class="code">align-exclude-rules-list</code> just like
<code class="code">align-mode-rules-list</code> overrides <code class="code">align-rules-list</code>.
</p>
<a class="index-entry-id" id="index-alignment-sections"></a>
<a class="index-entry-id" id="index-align_002dregion_002dseparate"></a>
<p><kbd class="kbd">M-x align</kbd> splits the region into a series of <em class="dfn">sections</em>,
usually sequences of non-blank lines, and aligns each section
according to all matching alignment rule by expanding or contracting
stretches of whitespace.  <kbd class="kbd">M-x align</kbd> consistently aligns all
lines inside a single section, but it may align different sections in
the region differently.  The user option <code class="code">align-region-separate</code>
specifies how <kbd class="kbd">M-x align</kbd> separates the region to sections.  This
option can be one of the symbols <code class="code">entire</code>, <code class="code">group</code>, or a
regular expression.  If <code class="code">align-region-separate</code> is <code class="code">entire</code>,
Emacs aligns the entire region as a single section.  If this option is
<code class="code">group</code>, Emacs aligns each group of consecutive non-blank lines
in the region as a separate section.  If <code class="code">align-region-separate</code>
is a regular expression, <kbd class="kbd">M-x align</kbd> scans the region for matches
to that regular expression and treats them as section separators.  By
default <code class="code">align-region-separate</code> is set to a regular expression
that matches blank lines and lines that contains only whitespace and a
single curly brace (&lsquo;<samp class="samp">{</samp>&rsquo; or &lsquo;<samp class="samp">}</samp>&rsquo;).  For special cases where
regular expressions are not accurate enough, you can also set
<code class="code">align-region-separate</code> to a function that says how to separate
the region to alignment sections.  See the documentation string of
<code class="code">align-region-separate</code> for more details.  Specific alignment
rules can override the value of <code class="code">align-region-separate</code> and
define their own section separator by specifying the <code class="code">separate</code>
rule attribute.
</p>
<p>If you call <kbd class="kbd">M-x align</kbd> with a prefix argument (<kbd class="kbd">C-u</kbd>), it
enables more alignment rules that are often useful but may sometimes
be too intrusive.  For example, in a Lisp buffer with the following
form:
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(set-face-attribute 'mode-line-inactive nil
                    :box nil
                    :background nil
                    :underline &quot;black&quot;)
</pre></div>

<p>Typing (<kbd class="kbd">C-u M-x align</kbd>) yields:
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(set-face-attribute 'mode-line-inactive nil
                    :box                nil
                    :background         nil
                    :underline          &quot;black&quot;)
</pre></div>

<p>In most cases, you should try <kbd class="kbd">M-x align</kbd> without a prefix
argument first, and if that doesn&rsquo;t produce the right result you can
undo with <kbd class="kbd">C-/</kbd> and try again with <kbd class="kbd">C-u M-x align</kbd>.
</p>
<a class="index-entry-id" id="index-align_002dhighlight_002drule"></a>
<a class="index-entry-id" id="index-align_002dunhighlight_002drule"></a>
<p>You can use the command <kbd class="kbd">M-x align-highlight-rule</kbd> to visualize
the effect of a specific alignment or exclusion rule in the current
region.  This command prompts you for the title of a rule and
highlights the parts on the region that this rule affects.  For
alignment rules, this command highlights the whitespace that <kbd class="kbd">M-x
align</kbd> would expand or contract, and for exclusion this command
highlights the parts that <kbd class="kbd">M-x align</kbd> would exclude from
alignment.  To remove the highlighting that this command creates, type
<kbd class="kbd">M-x align-unhighlight-rule</kbd>.
</p>
<a class="index-entry-id" id="index-align_002dcurrent"></a>
<a class="index-entry-id" id="index-align_002dentire"></a>
<p>The command <kbd class="kbd">M-x align-current</kbd> is similar to <kbd class="kbd">M-x align</kbd>,
except that it operates only on the alignment section that contains
point regardless of the current region.  This command determines the
boundaries of the current section according to the section separators
that <code class="code">align-region-separate</code> define.  <kbd class="kbd">M-x align-entire</kbd> is
another variant of <kbd class="kbd">M-x align</kbd>, that disregards
<code class="code">align-region-separate</code> and aligns the entire region as a single
alignment section with consistent alignment.  If you set
<code class="code">align-region-separate</code> to <code class="code">entire</code>, <kbd class="kbd">M-x align</kbd> behaves
like <kbd class="kbd">M-x align-entire</kbd> by default.  To illustrate the effect of
aligning the entire region as a single alignment section, consider the
following code:
</p>
<div class="example">
<pre class="example-preformatted">one = 1;
foobarbaz = 2;

spam = 3;
emacs = 4;
</pre></div>

<p>when the region covers all of these lines, typing <kbd class="kbd">M-x align</kbd>
yields:
</p>
<div class="example">
<pre class="example-preformatted">one       = 1;
foobarbaz = 2;

spam  = 3;
emacs = 4;
</pre></div>

<p>On the other hand, <kbd class="kbd">M-x align-entire</kbd> aligns all of the lines as a
single section, so the &lsquo;<samp class="samp">=</samp>&rsquo; appears at the same column in all
lines:
</p>
<div class="example">
<pre class="example-preformatted">one       = 1;
foobarbaz = 2;

spam      = 3;
emacs     = 4;
</pre></div>

<a class="index-entry-id" id="index-align_002dregexp"></a>
<p>The command <kbd class="kbd">M-x align-regexp</kbd> lets you align the current region
with an alignment rule that you define ad-hoc, instead of using the
predefined rules in <code class="code">align-rules-list</code>.  <kbd class="kbd">M-x align-regexp</kbd>
prompts you for a regular expression and uses that expression as the
<code class="code">regexp</code> attribute for an ad-hoc alignment rule that this command
uses to align the current region.  By default, this command adjusts
the whitespace that matches the first sub-expression of the regular
expression you specify.  If you call <kbd class="kbd">M-x align-regexp</kbd> with a
prefix argument, it also prompts you for the sub-expression to use and
lets you specify the amount of whitespace to use as padding, as well
as whether to apply the rule repeatedly to all matches of the regular
expression in each line.  See <a class="xref" href="Regexp-Backslash.html">Backslash in Regular Expressions</a>, for more
information about regular expressions and their sub-expressions.
</p>
<a class="index-entry-id" id="index-align_002dindent_002dbefore_002daligning"></a>
<p>If the user option <code class="code">align-indent-before-aligning</code> is
non-<code class="code">nil</code>, Emacs indents the region before aligning it with
<kbd class="kbd">M-x align</kbd>.  See <a class="xref" href="Indentation.html">Indentation</a>.  By default
<code class="code">align-indent-before-aligning</code> is set to <code class="code">nil</code>.
</p>
<a class="index-entry-id" id="index-align_002dto_002dtab_002dstop"></a>
<p>The user option <code class="code">align-to-tab-stop</code> says whether aligned parts
should start at a tab stop (see <a class="pxref" href="Tab-Stops.html">Tab Stops</a>).  If this option is
<code class="code">nil</code>, <kbd class="kbd">M-x align</kbd> uses just enough whitespace for alignment,
disregarding tab stops.  If this is a non-<code class="code">nil</code> symbol, <kbd class="kbd">M-x
align</kbd> checks the value of that symbol, and if this value is
non-<code class="code">nil</code>, <kbd class="kbd">M-x align</kbd> aligns to tab stops.  By default, this
option is set to <code class="code">indent-tabs-mode</code>, so alignment respects tab
stops in buffers that use tabs for indentation.  See <a class="xref" href="Just-Spaces.html">Tabs vs. Spaces</a>.
</p>
<a class="index-entry-id" id="index-align_002ddefault_002dspacing"></a>
<p>The user option <code class="code">align-default-spacing</code> specifies the default
amount of whitespace that <kbd class="kbd">M-x align</kbd> and its related commands use
for padding between the different parts of each line when aligning it.
When <code class="code">align-to-tab-stop</code> is <code class="code">nil</code>, the value of
<code class="code">align-default-spacing</code> is the number of spaces to use for
padding; when <code class="code">align-to-tab-stop</code> is non-<code class="code">nil</code>, the value of
<code class="code">align-default-spacing</code> is instead the number of tab stops to
use.  Each alignment rule can override the default that
<code class="code">align-default-spacing</code> specifies with the <code class="code">spacing</code>
attribute rule.
</p></div>
<hr>
<div class="nav-panel">
<p>
Previous: <a href="Indent-Convenience.html">Convenience Features for Indentation</a>, Up: <a href="Indentation.html">Indentation</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Key-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
