<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- 这是 GNU Emacs 手册,
为 Emacs  29.2 更新

英文原版版权提示 - Original English version copyright note

Copyright © 1985-2024 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "The GNU Manifesto," "Distribution" and
"GNU GENERAL PUBLIC LICENSE," with the Front-Cover Texts being "A GNU
Manual," and with the Back-Cover Texts as in (a) below.  A copy of the
license is included in the section entitled "GNU Free Documentation
License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom."

中文翻译版版权提示 - Chinese translation revision copyright notice

版权所有 © 1985-2024 林羿轩(Ralph Lin).

您有在 Free Software Foundation发布的GNU Free Documentation License 第1.3版或之后版本的约束下对其进行再发布及修的权利。 恒定章节为 "The GNU Manifesto," "分发" "(中文版)GNU GENERAL PUBLIC LICENSE" 和
"GNU GENERAL PUBLIC LICENSE" , 前封面文字为 "A GNU
Manual,"后封面文字如下(a).  本书的FDL许可证可以在 "GNU Free Documentation
License."找到.

(a) FSF的后封面文字为: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom."
 -->
<title>Regexp Replace (GNU Emacs Manual)</title>

<meta name="description" content="Regexp Replace (GNU Emacs Manual)">
<meta name="keywords" content="Regexp Replace (GNU Emacs Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Key-Index.html" rel="index" title="Key Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Replace.html" rel="up" title="Replace">
<link href="Replacement-and-Lax-Matches.html" rel="next" title="Replacement and Lax Matches">
<link href="Unconditional-Replace.html" rel="prev" title="Unconditional Replace">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
kbd.kbd {font-style: oblique}
kbd.key {font-style: normal}
span:hover a.copiable-link {visibility: visible}
-->
</style>


</head>

<body lang="zh_CN">
<div class="subsection-level-extent" id="Regexp-Replace">
<div class="nav-panel">
<p>
Next: <a href="Replacement-and-Lax-Matches.html" accesskey="n" rel="next">Replace Commands and Lax Matches</a>, Previous: <a href="Unconditional-Replace.html" accesskey="p" rel="prev">Unconditional Replacement</a>, Up: <a href="Replace.html" accesskey="u" rel="up">Replacement Commands</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Key-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h4 class="subsection" id="Regexp-Replacement"><span>16.10.2 Regexp Replacement<a class="copiable-link" href="#Regexp-Replacement"> &para;</a></span></h4>
<a class="index-entry-id" id="index-replace_002dregexp"></a>

<p>The <kbd class="kbd">M-x replace-string</kbd> command replaces exact matches for a
single string.  The similar command <kbd class="kbd">M-x replace-regexp</kbd> replaces
any match for a specified regular expression pattern (see <a class="pxref" href="Regexps.html">Syntax of Regular Expressions</a>).
</p>
<dl class="table">
<dt><kbd class="kbd">M-x replace-regexp <kbd class="key">RET</kbd> <var class="var">regexp</var> <kbd class="key">RET</kbd> <var class="var">newstring</var> <kbd class="key">RET</kbd></kbd></dt>
<dd><p>Replace every match for <var class="var">regexp</var> with <var class="var">newstring</var>.
</p></dd>
</dl>

<a class="index-entry-id" id="index-back-reference_002c-in-regexp-replacement"></a>
<p>In <code class="code">replace-regexp</code>, the <var class="var">newstring</var> need not be constant:
it can refer to all or part of what is matched by the <var class="var">regexp</var>.
&lsquo;<samp class="samp">\&amp;</samp>&rsquo; in <var class="var">newstring</var> stands for the entire match being
replaced.  &lsquo;<samp class="samp">\<var class="var">d</var></samp>&rsquo; in <var class="var">newstring</var>, where <var class="var">d</var> is a
digit starting from 1, stands for whatever matched the <var class="var">d</var>th
parenthesized grouping in <var class="var">regexp</var>.  (This is called a &ldquo;back
reference&rdquo;.)  &lsquo;<samp class="samp">\#</samp>&rsquo; refers to the count of replacements already
made in this command, as a decimal number.  In the first replacement,
&lsquo;<samp class="samp">\#</samp>&rsquo; stands for &lsquo;<samp class="samp">0</samp>&rsquo;; in the second, for &lsquo;<samp class="samp">1</samp>&rsquo;; and so on.
For example,
</p>
<div class="example">
<pre class="example-preformatted">M-x replace-regexp <kbd class="key">RET</kbd> c[ad]+r <kbd class="key">RET</kbd> \&amp;-safe <kbd class="key">RET</kbd>
</pre></div>

<p>replaces (for example) &lsquo;<samp class="samp">cadr</samp>&rsquo; with &lsquo;<samp class="samp">cadr-safe</samp>&rsquo; and &lsquo;<samp class="samp">cddr</samp>&rsquo;
with &lsquo;<samp class="samp">cddr-safe</samp>&rsquo;.
</p>
<div class="example">
<pre class="example-preformatted">M-x replace-regexp <kbd class="key">RET</kbd> \(c[ad]+r\)-safe <kbd class="key">RET</kbd> \1 <kbd class="key">RET</kbd>
</pre></div>

<p>performs the inverse transformation.  To include a &lsquo;<samp class="samp">\</samp>&rsquo; in the
text to replace with, you must enter &lsquo;<samp class="samp">\\</samp>&rsquo;.
</p>
<p>If you want to enter part of the replacement string by hand each
time, use &lsquo;<samp class="samp">\?</samp>&rsquo; in the replacement string.  Each replacement will
ask you to edit the replacement string in the minibuffer, putting
point where the &lsquo;<samp class="samp">\?</samp>&rsquo; was.
</p>
<p>The remainder of this subsection is intended for specialized tasks
and requires knowledge of Lisp.  Most readers can skip it.
</p>
<p>You can use Lisp expressions to calculate parts of the
replacement string.  To do this, write &lsquo;<samp class="samp">\,</samp>&rsquo; followed by the
expression in the replacement string.  Each replacement calculates the
value of the expression and converts it to text without quoting (if
it&rsquo;s a string, this means using the string&rsquo;s contents), and uses it in
the replacement string in place of the expression itself.  If the
expression is a symbol, one space in the replacement string after the
symbol name goes with the symbol name, so the value replaces them
both.
</p>
<p>Inside such an expression, you can use some special sequences.
&lsquo;<samp class="samp">\&amp;</samp>&rsquo; and &lsquo;<samp class="samp">\<var class="var">d</var></samp>&rsquo; refer here, as usual, to the entire
match as a string, and to a submatch as a string.  <var class="var">d</var> may be
multiple digits, and the value of &lsquo;<samp class="samp">\<var class="var">d</var></samp>&rsquo; is <code class="code">nil</code> if the
<var class="var">d</var>&rsquo;th parenthesized grouping did not match.  You can also use
&lsquo;<samp class="samp">\#&amp;</samp>&rsquo; and &lsquo;<samp class="samp">\#<var class="var">d</var></samp>&rsquo; to refer to those matches as numbers
(this is valid when the match or submatch has the form of a numeral).
&lsquo;<samp class="samp">\#</samp>&rsquo; here too stands for the number of already-completed
replacements.
</p>
<p>For example, we can exchange &lsquo;<samp class="samp">x</samp>&rsquo; and &lsquo;<samp class="samp">y</samp>&rsquo; this way:
</p>
<div class="example">
<pre class="example-preformatted">M-x replace-regexp <kbd class="key">RET</kbd> \(x\)\|y <kbd class="key">RET</kbd>
\,(if \1 &quot;y&quot; &quot;x&quot;) <kbd class="key">RET</kbd>
</pre></div>

<p>For computing replacement strings for &lsquo;<samp class="samp">\,</samp>&rsquo;, the <code class="code">format</code>
function is often useful (see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Formatting-Strings.html#Formatting-Strings">Formatting Strings</a> in <cite class="cite">The Emacs
Lisp Reference Manual</cite>).  For example, to add consecutively numbered
strings like &lsquo;<samp class="samp">ABC00042</samp>&rsquo; to columns 73 to&nbsp;80<!-- /@w --> (unless they are
already occupied), you can use
</p>
<div class="example">
<pre class="example-preformatted">M-x replace-regexp <kbd class="key">RET</kbd> ^.\{0,72\}$ <kbd class="key">RET</kbd>
\,(format &quot;%-72sABC%05d&quot; \&amp; \#) <kbd class="key">RET</kbd>
</pre></div>

</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Replacement-and-Lax-Matches.html">Replace Commands and Lax Matches</a>, Previous: <a href="Unconditional-Replace.html">Unconditional Replacement</a>, Up: <a href="Replace.html">Replacement Commands</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Key-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
