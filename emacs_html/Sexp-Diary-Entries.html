<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- 这是 GNU Emacs 手册,
为 Emacs  29.2 更新

英文原版版权提示 - Original English version copyright note

Copyright © 1985-2024 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "The GNU Manifesto," "Distribution" and
"GNU GENERAL PUBLIC LICENSE," with the Front-Cover Texts being "A GNU
Manual," and with the Back-Cover Texts as in (a) below.  A copy of the
license is included in the section entitled "GNU Free Documentation
License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom."

中文翻译版版权提示 - Chinese translation revision copyright notice

版权所有 © 1985-2024 林羿轩(Ralph Lin).

您有在 Free Software Foundation发布的GNU Free Documentation License 第1.3版或之后版本的约束下对其进行再发布及修的权利。 恒定章节为 "The GNU Manifesto," "分发" "(中文版)GNU GENERAL PUBLIC LICENSE" 和
"GNU GENERAL PUBLIC LICENSE" , 前封面文字为 "A GNU
Manual,"后封面文字如下(a).  本书的FDL许可证可以在 "GNU Free Documentation
License."找到.

(a) FSF的后封面文字为: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom."
 -->
<title>Sexp Diary Entries (GNU Emacs Manual)</title>

<meta name="description" content="Sexp Diary Entries (GNU Emacs Manual)">
<meta name="keywords" content="Sexp Diary Entries (GNU Emacs Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Key-Index.html" rel="index" title="Key Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Advanced-Calendar_002fDiary-Usage.html" rel="up" title="Advanced Calendar/Diary Usage">
<link href="Fancy-Diary-Display.html" rel="prev" title="Fancy Diary Display">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
kbd.kbd {font-style: oblique}
kbd.key {font-style: normal}
span:hover a.copiable-link {visibility: visible}
-->
</style>


</head>

<body lang="zh_CN">
<div class="subsection-level-extent" id="Sexp-Diary-Entries">
<div class="nav-panel">
<p>
Previous: <a href="Fancy-Diary-Display.html" accesskey="p" rel="prev">Fancy Diary Display</a>, Up: <a href="Advanced-Calendar_002fDiary-Usage.html" accesskey="u" rel="up">More advanced features of the Calendar and Diary</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Key-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h4 class="subsection" id="Sexp-Entries-and-the-Fancy-Diary-Display"><span>32.13.10 Sexp Entries and the Fancy Diary Display<a class="copiable-link" href="#Sexp-Entries-and-the-Fancy-Diary-Display"> &para;</a></span></h4>
<a class="index-entry-id" id="index-sexp-diary-entries"></a>

<a class="index-entry-id" id="index-diary_002dsexp_002dentry_002dsymbol"></a>
<p>Sexp diary entries allow you to do more than just have complicated
conditions under which a diary entry applies.  Sexp entries should be
preceded by <code class="code">diary-sexp-entry-symbol</code> (default &lsquo;<samp class="samp">%%</samp>&rsquo;) in the
diary file.  With the fancy diary display, sexp entries can generate the
text of the entry depending on the date itself.
</p>
<p>For example, an anniversary diary entry can insert
the number of years since the anniversary date into the text of the
diary entry.  Thus the &lsquo;<samp class="samp">%d</samp>&rsquo; in this diary entry:
</p>
<a class="index-entry-id" id="index-diary_002danniversary_002c-and-sexp-diary-entries"></a>
<div class="example smallexample">
<pre class="example-preformatted">%%(diary-anniversary 10 31 1948) Arthur's birthday (%d years old)
</pre></div>

<p>gets replaced by the age, so on October 31, 1990 the entry appears in
the fancy diary buffer like this:
</p>
<div class="example smallexample">
<pre class="example-preformatted">Arthur's birthday (42 years old)
</pre></div>

<p>If the diary file instead contains this entry:
</p>
<div class="example smallexample">
<pre class="example-preformatted">%%(diary-anniversary 10 31 1948) Arthur's %d%s birthday
</pre></div>

<p>the entry in the fancy diary buffer for October 31, 1990 appears like this:
</p>
<div class="example smallexample">
<pre class="example-preformatted">Arthur's 42nd birthday
</pre></div>

<p>Similarly, cyclic diary entries can interpolate the number of repetitions
that have occurred:
</p>
<a class="index-entry-id" id="index-diary_002dcyclic_002c-and-sexp-diary-entries"></a>
<div class="example smallexample">
<pre class="example-preformatted">%%(diary-cyclic 50 1 1 2012) Renew medication (%d%s time)
</pre></div>

<p>looks like this:
</p>
<div class="example smallexample">
<pre class="example-preformatted">Renew medication (5th time)
</pre></div>

<p>in the fancy diary display on September 7, 2012.
</p>
<p>There is an early-reminder diary sexp that includes its entry in the
diary not only on the date of occurrence, but also on earlier dates.
For example, if you want a reminder a week before your anniversary, you
can use
</p>
<a class="index-entry-id" id="index-diary_002dremind"></a>
<div class="example smallexample">
<pre class="example-preformatted">%%(diary-remind '(diary-anniversary 12 22 1968) 7) Ed's anniversary
</pre></div>

<p>and the fancy diary will show &lsquo;<samp class="samp">Ed's anniversary</samp>&rsquo; both on December
15 and on December 22.
</p>
<a class="index-entry-id" id="index-diary_002ddate"></a>
<p>The function <code class="code">diary-date</code> applies to dates described by a month,
day, year combination, each of which can be an integer, a list of
integers, or <code class="code">t</code> (meaning all values).  For example,
</p>
<div class="example smallexample">
<pre class="example-preformatted">%%(diary-date '(10 11 12) 22 t) Rake leaves
</pre></div>

<p>causes the fancy diary to show
</p>
<div class="example smallexample">
<pre class="example-preformatted">Rake leaves
</pre></div>

<p>on October 22, November 22, and December 22 of every year.
</p>
<a class="index-entry-id" id="index-diary_002dfloat_002c-and-sexp-diary-entries"></a>
<p>The function <code class="code">diary-float</code> allows you to describe diary entries
that apply to dates like the third Friday of November, or the last
Tuesday in April.  The parameters are the <var class="var">month</var>, <var class="var">dayname</var>,
and an index <var class="var">n</var>.  The entry appears on the <var class="var">n</var>th <var class="var">dayname</var>
after the first day of <var class="var">month</var>, where <var class="var">dayname</var>=0 means Sunday,
1 means Monday, and so on.  If <var class="var">n</var> is negative it counts backward
from the end of <var class="var">month</var>.  The value of <var class="var">month</var> can be a list of
months, a single month, or <code class="code">t</code> to specify all months.  You can also
use an optional parameter <var class="var">day</var> to specify the <var class="var">n</var>th
<var class="var">dayname</var> on or after/before <var class="var">day</var> of <var class="var">month</var>; the value of
<var class="var">day</var> defaults to 1 if <var class="var">n</var> is positive and to the last day of
<var class="var">month</var> if <var class="var">n</var> is negative.  For example,
</p>
<div class="example smallexample">
<pre class="example-preformatted">%%(diary-float t 1 -1) Pay rent
</pre></div>

<p>causes the fancy diary to show
</p>
<div class="example smallexample">
<pre class="example-preformatted">Pay rent
</pre></div>

<p>on the last Monday of every month.
</p>
<p>The generality of sexp diary entries lets you specify any diary
entry that you can describe algorithmically.  A sexp diary entry
contains an expression that computes whether the entry applies to any
given date.  If its value is non-<code class="code">nil</code>, the entry applies to that
date; otherwise, it does not.  The expression can use the variable
<code class="code">date</code> to find the date being considered; its value is a list
(<var class="var">month</var> <var class="var">day</var> <var class="var">year</var>) that refers to the Gregorian
calendar.
</p>
<p>The sexp diary entry applies to a date when the expression&rsquo;s value
is non-<code class="code">nil</code>, but some values have more specific meanings.  If
the value is a string, that string is a description of the event which
occurs on that date.  The value can also have the form
<code class="code">(<var class="var">mark</var> . <var class="var">string</var>)</code>; then <var class="var">mark</var> specifies how to
mark the date in the calendar, and <var class="var">string</var> is the description of
the event.  If <var class="var">mark</var> is a single-character string, that character
appears next to the date in the calendar.  If <var class="var">mark</var> is a face
name, the date is displayed in that face.  If <var class="var">mark</var> is
<code class="code">nil</code>, that specifies no particular highlighting for the date.
</p>
<p>Suppose you get paid on the 21st of the month if it is a weekday, and
on the Friday before if the 21st is on a weekend.  Here is how to write
a sexp diary entry that matches those dates:
</p>
<div class="example smallexample">
<pre class="example-preformatted">&amp;%%(let ((dayname (calendar-day-of-week date))
         (day (cadr date)))
      (or (and (= day 21) (memq dayname '(1 2 3 4 5)))
          (and (memq day '(19 20)) (= dayname 5)))
         ) Pay check deposited
</pre></div>

<p>The following sexp diary entries take advantage of the ability (in the fancy
diary display) to concoct diary entries whose text varies based on the date:
</p>
<a class="index-entry-id" id="index-diary_002dsunrise_002dsunset"></a>
<a class="index-entry-id" id="index-diary_002dlunar_002dphases"></a>
<a class="index-entry-id" id="index-diary_002dday_002dof_002dyear"></a>
<a class="index-entry-id" id="index-diary_002diso_002ddate"></a>
<a class="index-entry-id" id="index-diary_002djulian_002ddate"></a>
<a class="index-entry-id" id="index-diary_002dastro_002dday_002dnumber"></a>
<a class="index-entry-id" id="index-diary_002dbahai_002ddate"></a>
<a class="index-entry-id" id="index-diary_002dchinese_002ddate"></a>
<a class="index-entry-id" id="index-diary_002dcoptic_002ddate"></a>
<a class="index-entry-id" id="index-diary_002dethiopic_002ddate"></a>
<a class="index-entry-id" id="index-diary_002dhebrew_002ddate"></a>
<a class="index-entry-id" id="index-diary_002dislamic_002ddate"></a>
<a class="index-entry-id" id="index-diary_002dfrench_002ddate"></a>
<a class="index-entry-id" id="index-diary_002dmayan_002ddate"></a>
<a class="index-entry-id" id="index-diary_002dpersian_002ddate"></a>
<dl class="table">
<dt><code class="code">%%(diary-sunrise-sunset)</code></dt>
<dd><p>Make a diary entry for today&rsquo;s local times of sunrise and sunset.
</p></dd>
<dt><code class="code">%%(diary-lunar-phases)</code></dt>
<dd><p>Make a diary entry for the phases (quarters) of the moon.
</p></dd>
<dt><code class="code">%%(diary-day-of-year)</code></dt>
<dd><p>Make a diary entry with today&rsquo;s day number in the current year and the number
of days remaining in the current year.
</p></dd>
<dt><code class="code">%%(diary-iso-date)</code></dt>
<dd><p>Make a diary entry with today&rsquo;s equivalent ISO commercial date.
</p></dd>
<dt><code class="code">%%(diary-julian-date)</code></dt>
<dd><p>Make a diary entry with today&rsquo;s equivalent Julian calendar date.
</p></dd>
<dt><code class="code">%%(diary-astro-day-number)</code></dt>
<dd><p>Make a diary entry with today&rsquo;s equivalent astronomical (Julian) day number.
</p></dd>
<dt><code class="code">%%(diary-bahai-date)</code></dt>
<dd><p>Make a diary entry with today&rsquo;s equivalent Bahá&rsquo;í calendar date.
</p></dd>
<dt><code class="code">%%(diary-chinese-date)</code></dt>
<dd><p>Make a diary entry with today&rsquo;s equivalent Chinese calendar date.
</p></dd>
<dt><code class="code">%%(diary-coptic-date)</code></dt>
<dd><p>Make a diary entry with today&rsquo;s equivalent Coptic calendar date.
</p></dd>
<dt><code class="code">%%(diary-ethiopic-date)</code></dt>
<dd><p>Make a diary entry with today&rsquo;s equivalent Ethiopic calendar date.
</p></dd>
<dt><code class="code">%%(diary-french-date)</code></dt>
<dd><p>Make a diary entry with today&rsquo;s equivalent date on the French Revolutionary
calendar.
</p></dd>
<dt><code class="code">%%(diary-hebrew-date)</code></dt>
<dd><p>Make a diary entry with today&rsquo;s equivalent Hebrew calendar date.
</p></dd>
<dt><code class="code">%%(diary-islamic-date)</code></dt>
<dd><p>Make a diary entry with today&rsquo;s equivalent Islamic calendar date.
</p></dd>
<dt><code class="code">%%(diary-mayan-date)</code></dt>
<dd><p>Make a diary entry with today&rsquo;s equivalent Mayan calendar date.
</p></dd>
<dt><code class="code">%%(diary-persian-date)</code></dt>
<dd><p>Make a diary entry with today&rsquo;s equivalent Persian calendar date.
</p></dd>
</dl>

<p>For example, including the diary entry
</p>
<div class="example smallexample">
<pre class="example-preformatted">&amp;%%(diary-hebrew-date)
</pre></div>

<p>causes every day&rsquo;s diary display to contain the equivalent date on the
Hebrew calendar, if you are using the fancy diary display.  (With simple
diary display, the literal line &lsquo;<samp class="samp">&amp;%%(diary-hebrew-date)</samp>&rsquo; appears in
the diary for any date.)
</p>
<p>This function has been used to construct certain standard Hebrew sexp
diary entries:
</p>
<a class="index-entry-id" id="index-rosh-hodesh"></a>
<a class="index-entry-id" id="index-diary_002dhebrew_002drosh_002dhodesh"></a>
<a class="index-entry-id" id="index-parasha_002c-weekly"></a>
<a class="index-entry-id" id="index-diary_002dhebrew_002dparasha"></a>
<a class="index-entry-id" id="index-candle-lighting-times"></a>
<a class="index-entry-id" id="index-diary_002dhebrew_002dsabbath_002dcandles"></a>
<a class="index-entry-id" id="index-omer-count"></a>
<a class="index-entry-id" id="index-diary_002dhebrew_002domer"></a>
<a class="index-entry-id" id="index-yahrzeits_002c-and-sexp-diary-entries"></a>
<a class="index-entry-id" id="index-diary_002dhebrew_002dyahrzeit"></a>
<a class="index-entry-id" id="index-diary_002dhebrew_002dbirthday"></a>
<dl class="table">
<dt><code class="code">%%(diary-hebrew-rosh-hodesh)</code></dt>
<dd><p>Make a diary entry that tells the occurrence and ritual announcement of each
new Hebrew month.
</p></dd>
<dt><code class="code">%%(diary-hebrew-parasha)</code></dt>
<dd><p>Make a Saturday diary entry that tells the weekly synagogue scripture reading.
</p></dd>
<dt><code class="code">%%(diary-hebrew-sabbath-candles)</code></dt>
<dd><p>Make a Friday diary entry that tells the <em class="emph">local time</em> of Sabbath
candle lighting.
</p></dd>
<dt><code class="code">%%(diary-hebrew-omer)</code></dt>
<dd><p>Make a diary entry that gives the omer count, when appropriate.
</p></dd>
<dt><code class="code">%%(diary-hebrew-yahrzeit <var class="var">month</var> <var class="var">day</var> <var class="var">year</var>) <var class="var">name</var></code></dt>
<dd><p>Make a diary entry marking the anniversary of a date of death.  The date
is the <em class="emph">Gregorian</em> (civil) date of death.  The diary entry appears
on the proper Hebrew calendar anniversary and on the day before.  (The
order of the parameters changes according to the calendar date style;
for example in the European style to <var class="var">day</var>, <var class="var">month</var>, <var class="var">year</var>.)
</p></dd>
<dt><code class="code">%%(diary-hebrew-birthday <var class="var">month</var> <var class="var">day</var> <var class="var">year</var>)</code></dt>
<dd><p>Make a diary entry for a birthday on the Hebrew calendar.
</p></dd>
</dl>

<p>All the functions documented above take an optional argument
<var class="var">mark</var> which specifies how to mark the date in the calendar display.
If one of these functions decides that it applies to a certain date,
it returns a value that contains <var class="var">mark</var>, as described above.
</p></div>
<hr>
<div class="nav-panel">
<p>
Previous: <a href="Fancy-Diary-Display.html">Fancy Diary Display</a>, Up: <a href="Advanced-Calendar_002fDiary-Usage.html">More advanced features of the Calendar and Diary</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Key-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
