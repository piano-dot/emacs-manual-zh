<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- 这是 GNU Emacs 手册,
为 Emacs  29.2 更新

英文原版版权提示 - Original English version copyright note

Copyright © 1985-2024 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "The GNU Manifesto," "Distribution" and
"GNU GENERAL PUBLIC LICENSE," with the Front-Cover Texts being "A GNU
Manual," and with the Back-Cover Texts as in (a) below.  A copy of the
license is included in the section entitled "GNU Free Documentation
License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom."

中文翻译版版权提示 - Chinese translation revision copyright notice

版权所有 © 1985-2024 林羿轩(Ralph Lin).

您有在 Free Software Foundation发布的GNU Free Documentation License 第1.3版或之后版本的约束下对其进行再发布及修的权利。 恒定章节为 "The GNU Manifesto," "分发" "(中文版)GNU GENERAL PUBLIC LICENSE" 和
"GNU GENERAL PUBLIC LICENSE" , 前封面文字为 "A GNU
Manual,"后封面文字如下(a).  本书的FDL许可证可以在 "GNU Free Documentation
License."找到.

(a) FSF的后封面文字为: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom."
 -->
<title>Keyboard Macro Counter (GNU Emacs Manual)</title>

<meta name="description" content="Keyboard Macro Counter (GNU Emacs Manual)">
<meta name="keywords" content="Keyboard Macro Counter (GNU Emacs Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Key-Index.html" rel="index" title="Key Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Keyboard-Macros.html" rel="up" title="Keyboard Macros">
<link href="Keyboard-Macro-Query.html" rel="next" title="Keyboard Macro Query">
<link href="Keyboard-Macro-Ring.html" rel="prev" title="Keyboard Macro Ring">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
kbd.kbd {font-style: oblique}
kbd.key {font-style: normal}
span:hover a.copiable-link {visibility: visible}
-->
</style>


</head>

<body lang="zh_CN">
<div class="section-level-extent" id="Keyboard-Macro-Counter">
<div class="nav-panel">
<p>
Next: <a href="Keyboard-Macro-Query.html" accesskey="n" rel="next">Executing Macros with Variations</a>, Previous: <a href="Keyboard-Macro-Ring.html" accesskey="p" rel="prev">The Keyboard Macro Ring</a>, Up: <a href="Keyboard-Macros.html" accesskey="u" rel="up">Keyboard Macros</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Key-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="The-Keyboard-Macro-Counter"><span>18.3 The Keyboard Macro Counter<a class="copiable-link" href="#The-Keyboard-Macro-Counter"> &para;</a></span></h3>

<p>Each keyboard macro has an associated counter, which is initialized
to 0 when you start defining the macro.  This <em class="dfn">current counter</em>
allows you to insert a number into the buffer that depends on the
number of times the macro has been called.  The counter is normally
incremented each time its value is inserted into the buffer.
</p>
<p>In addition to the current counter, keyboard macros also maintain the
<em class="dfn">previous counter</em>, which records the value the current counter
had last time it was incremented or set.  Note that incrementing the
current counter by zero, e.g., with <kbd class="kbd">C-u&nbsp;0&nbsp;C-x&nbsp;C-k&nbsp;C-i</kbd><!-- /@w -->, also
records the value of the current counter as the previous counter
value.
</p>
<dl class="table">
<dt><kbd class="kbd"><kbd class="key">F3</kbd></kbd></dt>
<dd><p>In a keyboard macro definition, insert the keyboard macro counter
value in the buffer (<code class="code">kmacro-start-macro-or-insert-counter</code>).
</p></dd>
<dt><kbd class="kbd">C-x C-k C-i</kbd></dt>
<dd><p>Insert the keyboard macro counter value in the buffer
(<code class="code">kmacro-insert-counter</code>).
</p></dd>
<dt><kbd class="kbd">C-x C-k C-c</kbd></dt>
<dd><p>Set the keyboard macro counter (<code class="code">kmacro-set-counter</code>).
</p></dd>
<dt><kbd class="kbd">C-x C-k C-a</kbd></dt>
<dd><p>Add the prefix arg to the keyboard macro counter (<code class="code">kmacro-add-counter</code>).
</p></dd>
<dt><kbd class="kbd">C-x C-k C-f</kbd></dt>
<dd><p>Specify the format for inserting the keyboard macro counter
(<code class="code">kmacro-set-format</code>).
</p></dd>
</dl>

<a class="index-entry-id" id="index-kmacro_002dinsert_002dcounter"></a>
<a class="index-entry-id" id="index-C_002dx-C_002dk-C_002di"></a>
<p>When you are defining a keyboard macro, the command <kbd class="key">F3</kbd>
(<code class="code">kmacro-start-macro-or-insert-counter</code>) inserts the current
value of the keyboard macro&rsquo;s counter into the buffer, and increments
the counter by 1.  (If you are not defining a macro, <kbd class="key">F3</kbd> begins a
macro definition instead.  See <a class="xref" href="Basic-Keyboard-Macro.html">Basic Use</a>.)  You can use
a numeric prefix argument to specify a different increment.  If you
just specify a <kbd class="kbd">C-u</kbd> prefix, that inserts the previous counter
value, and doesn&rsquo;t change the current value.
</p>
<p>As an example, let us show how the keyboard macro counter can be
used to build a numbered list.  Consider the following key sequence:
</p>
<div class="example">
<pre class="example-preformatted"><kbd class="key">F3</kbd> C-a <kbd class="key">F3</kbd> . <kbd class="key">SPC</kbd> <kbd class="key">F4</kbd>
</pre></div>

<p>As part of this keyboard macro definition, the string &lsquo;<samp class="samp">0. </samp>&rsquo; was
inserted into the beginning of the current line.  If you now move
somewhere else in the buffer and type <kbd class="key">F4</kbd> to invoke the macro,
the string &lsquo;<samp class="samp">1. </samp>&rsquo; is inserted at the beginning of that line.
Subsequent invocations insert &lsquo;<samp class="samp">2. </samp>&rsquo;, &lsquo;<samp class="samp">3. </samp>&rsquo;, and so forth.
</p>
<p>The command <kbd class="kbd">C-x C-k C-i</kbd> (<code class="code">kmacro-insert-counter</code>) does
the same thing as <kbd class="key">F3</kbd>, but it can be used outside a keyboard
macro definition.  When no keyboard macro is being defined or
executed, it inserts and increments the counter of the macro at the
head of the keyboard macro ring.
</p>
<a class="index-entry-id" id="index-kmacro_002dset_002dcounter"></a>
<a class="index-entry-id" id="index-C_002dx-C_002dk-C_002dc"></a>
<p>The command <kbd class="kbd">C-x C-k C-c</kbd> (<code class="code">kmacro-set-counter</code>) sets the
current macro counter to the value of the numeric argument.  If you use
it inside the macro, it operates on each repetition of the macro.  If
you specify just <kbd class="kbd">C-u</kbd> as the prefix, while executing the macro,
that resets the counter to the value it had at the beginning of the
current repetition of the macro (undoing any increments so far in this
repetition).
</p>
<a class="index-entry-id" id="index-kmacro_002dadd_002dcounter"></a>
<a class="index-entry-id" id="index-C_002dx-C_002dk-C_002da"></a>
<p>The command <kbd class="kbd">C-x C-k C-a</kbd> (<code class="code">kmacro-add-counter</code>) adds the
prefix argument to the current macro counter.  With just <kbd class="kbd">C-u</kbd> as
argument, it resets the counter to the last value inserted by any
keyboard macro.  (Normally, when you use this, the last insertion
will be in the same macro and it will be the same counter.)
</p>
<a class="index-entry-id" id="index-kmacro_002dset_002dformat"></a>
<a class="index-entry-id" id="index-C_002dx-C_002dk-C_002df"></a>
<p>The command <kbd class="kbd">C-x C-k C-f</kbd> (<code class="code">kmacro-set-format</code>) prompts for
the format to use when inserting the macro counter.  The default
format is &lsquo;<samp class="samp">%d</samp>&rsquo;, which means to insert the number in decimal
without any padding.  You can exit with empty minibuffer to reset the
format to this default.  You can specify any format string that the
<code class="code">format</code> function accepts and that makes sense with a single
integer extra argument (see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Formatting-Strings.html#Formatting-Strings">Formatting Strings</a> in <cite class="cite">The Emacs
Lisp Reference Manual</cite>).  Do not put the format string inside double
quotes when you insert it in the minibuffer.
</p>
<p>If you use this command while no keyboard macro is being defined or
executed, the new format affects all subsequent macro definitions.
Existing macros continue to use the format in effect when they were
defined.  If you set the format while defining a keyboard macro, this
affects the macro being defined from that point on, but it does not
affect subsequent macros.  Execution of the macro will, at each step,
use the format in effect at that step during its definition.  Changes
to the macro format during execution of a macro, like the
corresponding changes during its definition, have no effect on
subsequent macros.
</p>
<p>The format set by <kbd class="kbd">C-x C-k C-f</kbd> does not affect insertion of
numbers stored in registers.
</p>
<p>If you use a register as a counter, incrementing it on each
repetition of the macro, that accomplishes the same thing as a
keyboard macro counter.  See <a class="xref" href="Number-Registers.html">Keeping Numbers in Registers</a>.  For most purposes,
it is simpler to use a keyboard macro counter.
</p>
</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Keyboard-Macro-Query.html">Executing Macros with Variations</a>, Previous: <a href="Keyboard-Macro-Ring.html">The Keyboard Macro Ring</a>, Up: <a href="Keyboard-Macros.html">Keyboard Macros</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Key-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
