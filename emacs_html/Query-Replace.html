<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- 这是 GNU Emacs 手册,
为 Emacs  29.2 更新

英文原版版权提示 - Original English version copyright note

Copyright © 1985-2024 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "The GNU Manifesto," "Distribution" and
"GNU GENERAL PUBLIC LICENSE," with the Front-Cover Texts being "A GNU
Manual," and with the Back-Cover Texts as in (a) below.  A copy of the
license is included in the section entitled "GNU Free Documentation
License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom."

中文翻译版版权提示 - Chinese translation revision copyright notice

版权所有 © 1985-2024 林羿轩(Ralph Lin).

您有在 Free Software Foundation发布的GNU Free Documentation License 第1.3版或之后版本的约束下对其进行再发布及修的权利。 恒定章节为 "The GNU Manifesto," "分发" "(中文版)GNU GENERAL PUBLIC LICENSE" 和
"GNU GENERAL PUBLIC LICENSE" , 前封面文字为 "A GNU
Manual,"后封面文字如下(a).  本书的FDL许可证可以在 "GNU Free Documentation
License."找到.

(a) FSF的后封面文字为: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom."
 -->
<title>Query Replace (GNU Emacs Manual)</title>

<meta name="description" content="Query Replace (GNU Emacs Manual)">
<meta name="keywords" content="Query Replace (GNU Emacs Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Key-Index.html" rel="index" title="Key Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Replace.html" rel="up" title="Replace">
<link href="Replacement-and-Lax-Matches.html" rel="prev" title="Replacement and Lax Matches">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
kbd.kbd {font-style: oblique}
kbd.key {font-style: normal}
span.r {font-family: initial; font-weight: normal; font-style: normal}
span:hover a.copiable-link {visibility: visible}
-->
</style>


</head>

<body lang="zh_CN">
<div class="subsection-level-extent" id="Query-Replace">
<div class="nav-panel">
<p>
Previous: <a href="Replacement-and-Lax-Matches.html" accesskey="p" rel="prev">Replace Commands and Lax Matches</a>, Up: <a href="Replace.html" accesskey="u" rel="up">Replacement Commands</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Key-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h4 class="subsection" id="Query-Replace-1"><span>16.10.4 Query Replace<a class="copiable-link" href="#Query-Replace-1"> &para;</a></span></h4>
<a class="index-entry-id" id="index-query-replace"></a>

<dl class="table">
<dt><kbd class="kbd">M-% <var class="var">string</var> <kbd class="key">RET</kbd> <var class="var">newstring</var> <kbd class="key">RET</kbd></kbd></dt>
<dd><p>Replace some occurrences of <var class="var">string</var> with <var class="var">newstring</var>.
</p></dd>
<dt><kbd class="kbd">C-M-% <var class="var">regexp</var> <kbd class="key">RET</kbd> <var class="var">newstring</var> <kbd class="key">RET</kbd></kbd></dt>
<dd><p>Replace some matches for <var class="var">regexp</var> with <var class="var">newstring</var>.
</p></dd>
</dl>

<a class="index-entry-id" id="index-M_002d_0025"></a>
<a class="index-entry-id" id="index-query_002dreplace"></a>
<p>If you want to change only some of the occurrences of &lsquo;<samp class="samp">foo</samp>&rsquo; to
&lsquo;<samp class="samp">bar</samp>&rsquo;, not all of them, use <kbd class="kbd">M-%</kbd> (<code class="code">query-replace</code>).
This command finds occurrences of &lsquo;<samp class="samp">foo</samp>&rsquo; one by one, displays each
occurrence and asks you whether to replace it.  Aside from querying,
<code class="code">query-replace</code> works just like <code class="code">replace-string</code>
(see <a class="pxref" href="Unconditional-Replace.html">Unconditional Replacement</a>).  In particular, it preserves case
provided that <code class="code">case-replace</code> is non-<code class="code">nil</code>, as it normally is
(see <a class="pxref" href="Replacement-and-Lax-Matches.html">Replace Commands and Lax Matches</a>).  A numeric argument means to
consider only occurrences that are bounded by word-delimiter
characters.  A negative prefix argument replaces backward.
</p>
<a class="index-entry-id" id="index-C_002dM_002d_0025"></a>
<a class="index-entry-id" id="index-query_002dreplace_002dregexp"></a>
<p><kbd class="kbd">C-M-%</kbd> performs regexp search and replace (<code class="code">query-replace-regexp</code>).
It works like <code class="code">replace-regexp</code> except that it queries
like <code class="code">query-replace</code>.
</p>
<a class="index-entry-id" id="index-query_002dreplace_002dfrom_002dto_002dseparator"></a>
<p>You can reuse earlier replacements with these commands.  When
<code class="code">query-replace</code> or <code class="code">query-replace-regexp</code> prompts for the
search string, use <kbd class="kbd">M-p</kbd> and <kbd class="kbd">M-n</kbd> to show previous
replacements in the form &lsquo;<samp class="samp"><var class="var">from</var> -&gt; <var class="var">to</var></samp>&rsquo;, where
<var class="var">from</var> is the search pattern, <var class="var">to</var> is its replacement, and the
separator between them is determined by the value of the variable
<code class="code">query-replace-from-to-separator</code>.  Type <kbd class="key">RET</kbd> to select the
desired replacement.  If the value of this variable is <code class="code">nil</code>,
replacements are not added to the command history, and cannot be
reused.
</p>
<a class="index-entry-id" id="index-faces-for-highlighting-query-replace"></a>
<a class="index-entry-id" id="index-query_002dreplace-face"></a>
<a class="index-entry-id" id="index-lazy_002dhighlight-face_002c-in-replace"></a>
<a class="index-entry-id" id="index-query_002dreplace_002dhighlight"></a>
<a class="index-entry-id" id="index-query_002dreplace_002dhighlight_002dsubmatches"></a>
<a class="index-entry-id" id="index-query_002dreplace_002dlazy_002dhighlight"></a>
<a class="index-entry-id" id="index-query_002dreplace_002dshow_002dreplacement"></a>
<p>These commands highlight the current match using the face
<code class="code">query-replace</code>.  You can disable this highlight by setting the
variable <code class="code">query-replace-highlight</code> to <code class="code">nil</code>.  They highlight
other matches using <code class="code">lazy-highlight</code> just like incremental search
(see <a class="pxref" href="Incremental-Search.html">Incremental Search</a>); this can be disabled by setting
<code class="code">query-replace-lazy-highlight</code> to <code class="code">nil</code>.  By default,
<code class="code">query-replace-regexp</code> will show the substituted replacement
string for the current match in the minibuffer.  If you want to keep
special sequences &lsquo;<samp class="samp">\&amp;</samp>&rsquo; and &lsquo;<samp class="samp">\<var class="var">n</var></samp>&rsquo; unexpanded, customize
<code class="code">query-replace-show-replacement</code> variable.
Like <code class="code">search-highlight-submatches</code> highlights subexpressions in
incremental search (see <a class="pxref" href="Search-Customizations.html">Tailoring Search to Your Needs</a>), the variable
<code class="code">query-replace-highlight-submatches</code> defines whether to highlight
subexpressions in the regexp replacement commands.
</p>
<a class="index-entry-id" id="index-query_002dreplace_002dskip_002dread_002donly"></a>
<p>The variable <code class="code">query-replace-skip-read-only</code>, if set
non-<code class="code">nil</code>, will cause replacement commands to ignore matches in
read-only text.  The default is not to ignore them.
</p>
<p>The characters you can type when you are shown a match for the string
or regexp are:
</p>

<dl class="table">
<dt><kbd class="kbd"><kbd class="key">SPC</kbd></kbd></dt>
<dt><kbd class="kbd">y</kbd></dt>
<dd><p>to replace the occurrence with <var class="var">newstring</var>.
</p>
</dd>
<dt><kbd class="kbd"><kbd class="key">DEL</kbd></kbd></dt>
<dt><kbd class="kbd"><kbd class="key">Delete</kbd></kbd></dt>
<dt><kbd class="kbd"><kbd class="key">BACKSPACE</kbd></kbd></dt>
<dt><kbd class="kbd">n</kbd></dt>
<dd><p>to skip to the next occurrence without replacing this one.
</p>
</dd>
<dt><kbd class="kbd">, <span class="r">(Comma)</span></kbd></dt>
<dd><p>to replace this occurrence and display the result.  You are then asked
for another input character to say what to do next.  Since the
replacement has already been made, <kbd class="key">DEL</kbd> and <kbd class="key">SPC</kbd> are
equivalent in this situation; both move to the next occurrence.
</p>
<p>You can type <kbd class="kbd">C-r</kbd> at this point (see below) to alter the replaced
text.  You can also undo the replacement with the <code class="code">undo</code> command
(e.g., type <kbd class="kbd">C-x u</kbd>; see <a class="pxref" href="Undo.html">Undo</a>); this exits the
<code class="code">query-replace</code>, so if you want to do further replacement you
must use <kbd class="kbd">C-x <kbd class="key">ESC</kbd> <kbd class="key">ESC</kbd> <kbd class="key">RET</kbd></kbd> to restart
(see <a class="pxref" href="Repetition.html">Repeating Minibuffer Commands</a>).
</p>
</dd>
<dt><kbd class="kbd"><kbd class="key">RET</kbd></kbd></dt>
<dt><kbd class="kbd">q</kbd></dt>
<dd><p>to exit without doing any more replacements.
</p>
</dd>
<dt><kbd class="kbd">. <span class="r">(Period)</span></kbd></dt>
<dd><p>to replace this occurrence and then exit without searching for more
occurrences.
</p>
</dd>
<dt><kbd class="kbd">!</kbd></dt>
<dd><p>to replace all remaining occurrences without asking again.
</p>
</dd>
<dt><kbd class="kbd">^</kbd></dt>
<dd><p>to go back to the position of the previous occurrence (or what used to
be an occurrence), in case you changed it by mistake or want to
reexamine it.
</p>
</dd>
<dt><kbd class="kbd">u</kbd></dt>
<dd><p>to undo the last replacement and go back to where that replacement was
made.
</p>
</dd>
<dt><kbd class="kbd">U</kbd></dt>
<dd><p>to undo all the replacements and go back to where the first
replacement was made.
</p>
</dd>
<dt><kbd class="kbd">C-r</kbd></dt>
<dd><p>to enter a recursive editing level, in case the occurrence needs to be
edited rather than just replaced with <var class="var">newstring</var>.  When you are
done, exit the recursive editing level with <kbd class="kbd">C-M-c</kbd> to proceed to
the next occurrence.  See <a class="xref" href="Recursive-Edit.html">Recursive Editing Levels</a>.
</p>
</dd>
<dt><kbd class="kbd">C-w</kbd></dt>
<dd><p>to delete the occurrence, and then enter a recursive editing level as in
<kbd class="kbd">C-r</kbd>.  Use the recursive edit to insert text to replace the deleted
occurrence of <var class="var">string</var>.  When done, exit the recursive editing level
with <kbd class="kbd">C-M-c</kbd> to proceed to the next occurrence.
</p>
</dd>
<dt><kbd class="kbd">e</kbd></dt>
<dd><p>to edit the replacement string in the minibuffer.  When you exit the
minibuffer by typing <kbd class="key">RET</kbd>, the minibuffer contents replace the
current occurrence of the pattern.  They also become the new
replacement string for any further occurrences.
</p>
</dd>
<dt><kbd class="kbd">E</kbd></dt>
<dd><p>is like <kbd class="kbd">e</kbd>, but the next replacement will be done with exact
case.  I.e., if you have a <code class="code">query-replace</code> from &lsquo;<samp class="samp">foo</samp>&rsquo; to
&lsquo;<samp class="samp">bar</samp>&rsquo;, a text like &lsquo;<samp class="samp">Foo</samp>&rsquo; will be normally be replaced with
&lsquo;<samp class="samp">Bar</samp>&rsquo;.  Use this command to do the current replacement with exact
case.
</p>
</dd>
<dt><kbd class="kbd">C-l</kbd></dt>
<dd><p>to redisplay the screen.  Then you must type another character to
specify what to do with this occurrence.
</p>
</dd>
<dt><kbd class="kbd">Y <span class="r">(Upper-case)</span></kbd></dt>
<dd><p>to replace all remaining occurrences in all remaining buffers in
multi-buffer replacements (like the Dired <kbd class="kbd">Q</kbd> command that performs
query replace on selected files).  It answers this question and all
subsequent questions in the series with &ldquo;yes&rdquo;, without further
user interaction.
</p>
</dd>
<dt><kbd class="kbd">N <span class="r">(Upper-case)</span></kbd></dt>
<dd><p>to skip to the next buffer in multi-buffer replacements without
replacing remaining occurrences in the current buffer.  It answers
this question &ldquo;no&rdquo;, gives up on the questions for the current buffer,
and continues to the next buffer in the sequence.
</p>
</dd>
<dt><kbd class="kbd">C-h</kbd></dt>
<dt><kbd class="kbd">?</kbd></dt>
<dt><kbd class="kbd"><kbd class="key">F1</kbd></kbd></dt>
<dd><p>to display a message summarizing these options.  Then you must type
another character to specify what to do with this occurrence.
</p></dd>
</dl>

<p>Aside from this, any other character exits the <code class="code">query-replace</code>,
and is then reread as part of a key sequence.  Thus, if you type
<kbd class="kbd">C-k</kbd>, it exits the <code class="code">query-replace</code> and then kills to end of
line.  In particular, <kbd class="kbd">C-g</kbd> simply exits the <code class="code">query-replace</code>.
</p>
<p>To restart a <code class="code">query-replace</code> once it is exited, use <kbd class="kbd">C-x
<kbd class="key">ESC</kbd> <kbd class="key">ESC</kbd></kbd>, which repeats the <code class="code">query-replace</code> because it
used the minibuffer to read its arguments.  See <a class="xref" href="Repetition.html">C-x <kbd class="key">ESC</kbd>
<kbd class="key">ESC</kbd></a>.
</p>
<a class="index-entry-id" id="index-invisible-text_002c-and-query_002dreplace"></a>
<p>The option <code class="code">search-invisible</code> determines how <code class="code">query-replace</code>
treats invisible text.  See <a class="xref" href="Outline-Visibility.html#Outline-Search">Outline Search</a>.
</p>
<p>See <a class="xref" href="Operating-on-Files.html">Operating on Files</a>, for the Dired <kbd class="kbd">Q</kbd> command which
performs query replace on selected files.  See also <a class="ref" href="Transforming-File-Names.html">Transforming File Names in Dired</a>, for Dired commands to rename, copy, or link files by
replacing regexp matches in file names.
</p>
</div>
<hr>
<div class="nav-panel">
<p>
Previous: <a href="Replacement-and-Lax-Matches.html">Replace Commands and Lax Matches</a>, Up: <a href="Replace.html">Replacement Commands</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Key-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
