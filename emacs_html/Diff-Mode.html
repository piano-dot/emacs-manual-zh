<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- 这是 GNU Emacs 手册,
为 Emacs  29.2 更新

英文原版版权提示 - Original English version copyright note

Copyright © 1985-2024 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "The GNU Manifesto," "Distribution" and
"GNU GENERAL PUBLIC LICENSE," with the Front-Cover Texts being "A GNU
Manual," and with the Back-Cover Texts as in (a) below.  A copy of the
license is included in the section entitled "GNU Free Documentation
License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom."

中文翻译版版权提示 - Chinese translation revision copyright notice

版权所有 © 1985-2024 林羿轩(Ralph Lin).

您有在 Free Software Foundation发布的GNU Free Documentation License 第1.3版或之后版本的约束下对其进行再发布及修的权利。 恒定章节为 "The GNU Manifesto," "分发" "(中文版)GNU GENERAL PUBLIC LICENSE" 和
"GNU GENERAL PUBLIC LICENSE" , 前封面文字为 "A GNU
Manual,"后封面文字如下(a).  本书的FDL许可证可以在 "GNU Free Documentation
License."找到.

(a) FSF的后封面文字为: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom."
 -->
<title>Diff Mode (GNU Emacs Manual)</title>

<meta name="description" content="Diff Mode (GNU Emacs Manual)">
<meta name="keywords" content="Diff Mode (GNU Emacs Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Key-Index.html" rel="index" title="Key Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Files.html" rel="up" title="Files">
<link href="Copying-and-Naming.html" rel="next" title="Copying and Naming">
<link href="Comparing-Files.html" rel="prev" title="Comparing Files">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
kbd.kbd {font-style: oblique}
kbd.key {font-style: normal}
span:hover a.copiable-link {visibility: visible}
-->
</style>


</head>

<body lang="zh_CN">
<div class="section-level-extent" id="Diff-Mode">
<div class="nav-panel">
<p>
Next: <a href="Copying-and-Naming.html" accesskey="n" rel="next">Copying, Naming and Renaming Files</a>, Previous: <a href="Comparing-Files.html" accesskey="p" rel="prev">Comparing Files</a>, Up: <a href="Files.html" accesskey="u" rel="up">File Handling</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Key-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="Diff-Mode-1"><span>19.10 Diff Mode<a class="copiable-link" href="#Diff-Mode-1"> &para;</a></span></h3>
<a class="index-entry-id" id="index-Diff-mode"></a>
<a class="index-entry-id" id="index-diff_002dmode"></a>
<a class="index-entry-id" id="index-patches_002c-editing"></a>

<p>Diff mode is a major mode used for the output of <kbd class="kbd">M-x diff</kbd> and
other similar commands.  This kind of output is called a <em class="dfn">patch</em>,
because it can be passed to the <code class="command">patch</code> command to
automatically apply the specified changes.  To select Diff mode
manually, type <kbd class="kbd">M-x diff-mode</kbd>.
</p>
<a class="index-entry-id" id="index-hunk_002c-diff"></a>
<p>The changes specified in a patch are grouped into <em class="dfn">hunks</em>, which
are contiguous chunks of text that contain one or more changed lines.
Hunks usually also include unchanged lines to provide context for the
changes.  Each hunk is preceded by a <em class="dfn">hunk header</em>, which
specifies the old and new line numbers where the hunk&rsquo;s changes occur.
Diff mode highlights each hunk header, to distinguish it from the
actual contents of the hunk.
</p>
<p>The first hunk in a patch is preceded by a file header, which shows
the names of the new and the old versions of the file, and their time
stamps.  If a patch shows changes for more than one file, each file
has such a header before the first hunk of that file&rsquo;s changes.
</p>
<a class="index-entry-id" id="index-diff_002dupdate_002don_002dthe_002dfly"></a>
<p>You can edit a Diff mode buffer like any other buffer.  (If it is
read-only, you need to make it writable first; see <a class="ref" href="Misc-Buffer.html">Miscellaneous Buffer Operations</a>.)
Whenever you edit a hunk, Diff mode attempts to automatically correct
the line numbers in the hunk headers, to ensure that the patch remains
correct, and could still be applied by <code class="command">patch</code>.  To disable
automatic line number correction, change the variable
<code class="code">diff-update-on-the-fly</code> to <code class="code">nil</code>.
</p>
<p>Diff mode arranges for hunks to be treated as compiler error
messages by <kbd class="kbd">M-g M-n</kbd> and other commands that handle error messages
(see <a class="pxref" href="Compilation-Mode.html">Compilation Mode</a>).  Thus, you can use the compilation-mode
commands to visit the corresponding source locations.
</p>
<p>In addition, Diff mode provides the following commands to navigate,
manipulate and apply parts of patches:
</p>
<dl class="table">
<dt><a id="index-diff_002dhunk_002dnext"></a><span><kbd class="kbd">M-n</kbd><a class="copiable-link" href="#index-diff_002dhunk_002dnext"> &para;</a></span></dt>
<dd><p>Move to the next hunk-start (<code class="code">diff-hunk-next</code>).  With prefix
argument <var class="var">n</var>, move forward to the <var class="var">n</var>th next hunk.
</p>
<a class="index-entry-id" id="index-diff_002drefine"></a>
<p>By default, Diff mode <em class="dfn">refines</em> hunks as Emacs displays them,
highlighting their changes with better granularity.  Alternatively, if
you set <code class="code">diff-refine</code> to the symbol <code class="code">navigation</code>, Diff mode
only refines the hunk you move to with this command or with
<code class="code">diff-hunk-prev</code>.
</p>
</dd>
<dt><a id="index-diff_002dhunk_002dprev"></a><span><kbd class="kbd">M-p</kbd><a class="copiable-link" href="#index-diff_002dhunk_002dprev"> &para;</a></span></dt>
<dd><p>Move to the previous hunk-start (<code class="code">diff-hunk-prev</code>).  With prefix
argument <var class="var">n</var>, move back to the <var class="var">n</var>th previous hunk.  Like
<kbd class="kbd">M-n</kbd>, this command refines the hunk you move to if you set
<code class="code">diff-refine</code> to the symbol <code class="code">navigation</code>.
</p>
</dd>
<dt><a id="index-diff_002dfile_002dnext"></a><span><kbd class="kbd">M-}</kbd><a class="copiable-link" href="#index-diff_002dfile_002dnext"> &para;</a></span></dt>
<dd><p>Move to the next file-start, in a multi-file patch
(<code class="code">diff-file-next</code>).  With prefix argument <var class="var">n</var>, move forward
to the start of the <var class="var">n</var>th next file.
</p>
</dd>
<dt><a id="index-diff_002dfile_002dprev"></a><span><kbd class="kbd">M-{</kbd><a class="copiable-link" href="#index-diff_002dfile_002dprev"> &para;</a></span></dt>
<dd><p>Move to the previous file-start, in a multi-file patch
(<code class="code">diff-file-prev</code>).  With prefix argument <var class="var">n</var>, move back to
the start of the <var class="var">n</var>th previous file.
</p>
</dd>
<dt><a id="index-diff_002dhunk_002dkill"></a><span><kbd class="kbd">M-k</kbd><a class="copiable-link" href="#index-diff_002dhunk_002dkill"> &para;</a></span></dt>
<dd><p>Kill the hunk at point (<code class="code">diff-hunk-kill</code>).
</p>
</dd>
<dt><a id="index-diff_002dfile_002dkill"></a><span><kbd class="kbd">M-K</kbd><a class="copiable-link" href="#index-diff_002dfile_002dkill"> &para;</a></span></dt>
<dd><p>In a multi-file patch, kill the current file part.
(<code class="code">diff-file-kill</code>).
</p>
</dd>
<dt><a class="index-entry-id" id="index-patches_002c-applying"></a>
<a id="index-diff_002dapply_002dhunk"></a><span><kbd class="kbd">C-c C-a</kbd><a class="copiable-link" href="#index-diff_002dapply_002dhunk"> &para;</a></span></dt>
<dd><p>Apply this hunk to its target file (<code class="code">diff-apply-hunk</code>).  With a
prefix argument of <kbd class="kbd">C-u</kbd>, revert this hunk, i.e. apply the
reverse of the hunk, which changes the &ldquo;new&rdquo; version into the &ldquo;old&rdquo;
version.  If <code class="code">diff-jump-to-old-file</code> is non-<code class="code">nil</code>, apply the
hunk to the &ldquo;old&rdquo; version of the file instead.
</p>
</dd>
<dt><a id="index-diff_002drefine_002dhunk"></a><span><kbd class="kbd">C-c C-b</kbd><a class="copiable-link" href="#index-diff_002drefine_002dhunk"> &para;</a></span></dt>
<dd><p>Highlight the changes of the hunk at point with a finer granularity
(<code class="code">diff-refine-hunk</code>).  This allows you to see exactly which parts
of each changed line were actually changed.
</p>
<a class="index-entry-id" id="index-diff_002drefine-1"></a>
<p>By default, Diff mode refines hunks as Emacs displays them, so you may
find this command useful if you customize <code class="code">diff-refine</code> to a
non-default value.
</p>
</dd>
<dt><a class="index-entry-id" id="index-diff_002djump_002dto_002dold_002dfile"></a>
<a id="index-diff_002dgoto_002dsource"></a><span><kbd class="kbd">C-c C-c</kbd><a class="copiable-link" href="#index-diff_002dgoto_002dsource"> &para;</a></span></dt>
<dd><p>Go to the source file and line corresponding to this hunk
(<code class="code">diff-goto-source</code>).  By default, this jumps to the &ldquo;new&rdquo;
version of the file, the one shown first on the file header.
With a prefix argument, jump to the &ldquo;old&rdquo; version instead.  If
<code class="code">diff-jump-to-old-file</code> is non-<code class="code">nil</code>, this command by
default jumps to the &ldquo;old&rdquo; file, and the meaning of the prefix
argument is reversed.  If the prefix argument is a number greater than
8 (e.g., if you type <kbd class="kbd">C-u C-u C-c C-c</kbd>), then this command also
sets <code class="code">diff-jump-to-old-file</code> for the next invocation.
If the source file is under version control (see <a class="pxref" href="Version-Control.html">Version Control</a>),
this jumps to the work file by default.  With a prefix argument, jump
to the &ldquo;old&rdquo; revision of the file (see <a class="pxref" href="Old-Revisions.html">Examining And Comparing Old Revisions</a>), when
point is on the old line, or otherwise jump to the &ldquo;new&rdquo; revision.
</p>
</dd>
<dt><a id="index-diff_002dediff_002dpatch"></a><span><kbd class="kbd">C-c C-e</kbd><a class="copiable-link" href="#index-diff_002dediff_002dpatch"> &para;</a></span></dt>
<dd><p>Start an Ediff session with the patch (<code class="code">diff-ediff-patch</code>).
See <a data-manual="ediff" href="https://www.gnu.org/software/emacs/manual/html_node/ediff/index.html#Top">Ediff</a> in <cite class="cite">The Ediff Manual</cite>.
</p>
</dd>
<dt><a id="index-diff_002drestrict_002dview"></a><span><kbd class="kbd">C-c C-n</kbd><a class="copiable-link" href="#index-diff_002drestrict_002dview"> &para;</a></span></dt>
<dd><p>Restrict the view to the current hunk (<code class="code">diff-restrict-view</code>).
See <a class="xref" href="Narrowing.html">Narrowing</a>.  With a prefix argument, restrict the
view to the current file of a multiple-file patch.  To widen again,
use <kbd class="kbd">C-x n w</kbd> (<code class="code">widen</code>).
</p>
</dd>
<dt><a id="index-diff_002dreverse_002ddirection"></a><span><kbd class="kbd">C-c C-r</kbd><a class="copiable-link" href="#index-diff_002dreverse_002ddirection"> &para;</a></span></dt>
<dd><p>Reverse the direction of comparison for the entire buffer
(<code class="code">diff-reverse-direction</code>).  With a prefix argument, reverse the
direction only inside the current region (see <a class="pxref" href="Mark.html">The Mark and the Region</a>).  Reversing
the direction means changing the hunks and the file-start headers to
produce a patch that would change the &ldquo;new&rdquo; version into the &ldquo;old&rdquo;
one.
</p>
</dd>
<dt><a id="index-diff_002dsplit_002dhunk"></a><span><kbd class="kbd">C-c C-s</kbd><a class="copiable-link" href="#index-diff_002dsplit_002dhunk"> &para;</a></span></dt>
<dd><p>Split the hunk at point (<code class="code">diff-split-hunk</code>) into two separate
hunks.  This inserts a hunk header and modifies the header of the
current hunk.  This command is useful for manually editing patches,
and only works with the <em class="dfn">unified diff format</em> produced by the
<samp class="option">-u</samp> or <samp class="option">--unified</samp> options to the <code class="command">diff</code>
program.  If you need to split a hunk in the <em class="dfn">context diff format</em>
produced by the <samp class="option">-c</samp> or <samp class="option">--context</samp> options to
<code class="command">diff</code>, first convert the buffer to the unified diff format
with <kbd class="kbd">C-c C-u</kbd>.
</p>
</dd>
<dt><a id="index-diff_002dunified_002d_003econtext"></a><span><kbd class="kbd">C-c C-d</kbd><a class="copiable-link" href="#index-diff_002dunified_002d_003econtext"> &para;</a></span></dt>
<dd><p>Convert the entire buffer to the <em class="dfn">context diff format</em>
(<code class="code">diff-unified-&gt;context</code>).  With a prefix argument, convert only
the hunks within the region.
</p>
</dd>
<dt><a id="index-diff_002dcontext_002d_003eunified"></a><span><kbd class="kbd">C-c C-u</kbd><a class="copiable-link" href="#index-diff_002dcontext_002d_003eunified"> &para;</a></span></dt>
<dd><p>Convert the entire buffer to unified diff format
(<code class="code">diff-context-&gt;unified</code>).  With a prefix argument, convert
unified format to context format.  When the mark is active, convert
only the hunks within the region.
</p>
</dd>
<dt><a id="index-diff_002drefresh_002dhunk"></a><span><kbd class="kbd">C-c C-l</kbd><a class="copiable-link" href="#index-diff_002drefresh_002dhunk"> &para;</a></span></dt>
<dd><p>Re-generate the current hunk (<code class="code">diff-refresh-hunk</code>).
</p>
</dd>
<dt><a id="index-diff_002dignore_002dwhitespace_002dhunk"></a><span><kbd class="kbd">C-c C-w</kbd><a class="copiable-link" href="#index-diff_002dignore_002dwhitespace_002dhunk"> &para;</a></span></dt>
<dd><p>Re-generate the current hunk, disregarding changes in whitespace
(<code class="code">diff-ignore-whitespace-hunk</code>).
</p>
</dd>
<dt><a class="index-entry-id" id="index-add_002dchange_002dlog_002dentry_002dother_002dwindow_002c-in-Diff-mode"></a>
<a id="index-diff_002dadd_002dchange_002dlog_002dentries_002dother_002dwindow"></a><span><kbd class="kbd">C-x 4 A</kbd><a class="copiable-link" href="#index-diff_002dadd_002dchange_002dlog_002dentries_002dother_002dwindow"> &para;</a></span></dt>
<dd><p>Generate a ChangeLog entry, like <kbd class="kbd">C-x 4 a</kbd> does (see <a class="pxref" href="Change-Log.html">Change Logs</a>), for each one of the hunks
(<code class="code">diff-add-change-log-entries-other-window</code>).  This creates a
skeleton of the log of changes that you can later fill with the actual
descriptions of the changes.  <kbd class="kbd">C-x 4 a</kbd> itself in Diff mode
operates on behalf of the current hunk&rsquo;s file, but gets the function
name from the patch itself.  This is useful for making log entries for
functions that are deleted by the patch.
</p></dd>
</dl>

<a class="index-entry-id" id="index-trailing-whitespace_002c-in-patches"></a>
<a class="index-entry-id" id="index-diff_002ddelete_002dtrailing_002dwhitespace"></a>
<p>Patches sometimes include trailing whitespace on modified lines, as
an unintentional and undesired change.  There are two ways to deal
with this problem.  Firstly, if you enable Whitespace mode in a Diff
buffer (see <a class="pxref" href="Useless-Whitespace.html">Useless Whitespace</a>), it automatically highlights
trailing whitespace in modified lines.  Secondly, you can use the
command <kbd class="kbd">M-x diff-delete-trailing-whitespace</kbd>, which searches for
trailing whitespace in the lines modified by the patch, and removes
that whitespace in both the patch and the patched source file(s).
This command does not save the modifications that it makes, so you can
decide whether to save the changes (the list of modified files is
displayed in the echo area).  With a prefix argument, it tries to
modify the original (&ldquo;old&rdquo;) source files rather than the patched
(&ldquo;new&rdquo;) source files.
</p>
<a class="index-entry-id" id="index-diff_002dfont_002dlock_002dsyntax"></a>
<p>If <code class="code">diff-font-lock-syntax</code> is non-<code class="code">nil</code>, fragments of
source in hunks are highlighted according to the appropriate major
mode.
</p>
</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Copying-and-Naming.html">Copying, Naming and Renaming Files</a>, Previous: <a href="Comparing-Files.html">Comparing Files</a>, Up: <a href="Files.html">File Handling</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Key-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
