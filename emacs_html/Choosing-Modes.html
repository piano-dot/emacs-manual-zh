<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- 这是 GNU Emacs 手册,
为 Emacs  29.2 更新

英文原版版权提示 - Original English version copyright note

Copyright © 1985-2024 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "The GNU Manifesto," "Distribution" and
"GNU GENERAL PUBLIC LICENSE," with the Front-Cover Texts being "A GNU
Manual," and with the Back-Cover Texts as in (a) below.  A copy of the
license is included in the section entitled "GNU Free Documentation
License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom."

中文翻译版版权提示 - Chinese translation revision copyright notice

版权所有 © 1985-2024 林羿轩(Ralph Lin).

您有在 Free Software Foundation发布的GNU Free Documentation License 第1.3版或之后版本的约束下对其进行再发布及修的权利。 恒定章节为 "The GNU Manifesto," "分发" "(中文版)GNU GENERAL PUBLIC LICENSE" 和
"GNU GENERAL PUBLIC LICENSE" , 前封面文字为 "A GNU
Manual,"后封面文字如下(a).  本书的FDL许可证可以在 "GNU Free Documentation
License."找到.

(a) FSF的后封面文字为: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom."
 -->
<title>Choosing Modes (GNU Emacs Manual)</title>

<meta name="description" content="Choosing Modes (GNU Emacs Manual)">
<meta name="keywords" content="Choosing Modes (GNU Emacs Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Key-Index.html" rel="index" title="Key Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Modes.html" rel="up" title="Modes">
<link href="Minor-Modes.html" rel="prev" title="Minor Modes">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
kbd.kbd {font-style: oblique}
kbd.key {font-style: normal}
span:hover a.copiable-link {visibility: visible}
-->
</style>


</head>

<body lang="zh_CN">
<div class="section-level-extent" id="Choosing-Modes">
<div class="nav-panel">
<p>
Previous: <a href="Minor-Modes.html" accesskey="p" rel="prev">Minor Modes</a>, Up: <a href="Modes.html" accesskey="u" rel="up">Major and Minor Modes</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Key-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="Choosing-File-Modes"><span>24.3 Choosing File Modes<a class="copiable-link" href="#Choosing-File-Modes"> &para;</a></span></h3>

<a class="index-entry-id" id="index-choosing-a-major-mode"></a>
<a class="index-entry-id" id="index-choosing-a-minor-mode"></a>
<a class="index-entry-id" id="index-auto_002dmode_002dalist"></a>
<p>When you visit a file, Emacs chooses a major mode automatically.
Normally, it makes the choice based on the file name&mdash;for example,
files whose names end in &lsquo;<samp class="samp">.c</samp>&rsquo; are normally edited in C mode&mdash;but
sometimes it chooses the major mode based on special text in the file.
This special text can also be used to enable buffer-local minor modes.
</p>
<p>Here is the exact procedure:
</p>
<p>First, Emacs checks whether the file contains file-local mode
variables.  See <a class="xref" href="File-Variables.html">Local Variables in Files</a>.  If there is a file-local variable
that specifies a major mode, then Emacs uses that major mode, ignoring
all other criteria.  There are several methods to specify a major mode
using a file-local variable; the simplest is to put the mode name in
the first nonblank line, preceded and followed by &lsquo;<samp class="samp">-*-</samp>&rsquo;.  Other
text may appear on the line as well.  For example,
</p>
<div class="example">
<pre class="example-preformatted">; -*-Lisp-*-
</pre></div>

<p>tells Emacs to use Lisp mode.  Note how the semicolon is used to make
Lisp treat this line as a comment.  You could equivalently write
</p>
<div class="example">
<pre class="example-preformatted">; -*- mode: Lisp;-*-
</pre></div>

<p>You can also use file-local variables to specify buffer-local minor
modes, by using <code class="code">eval</code> specifications.  For example, this first
nonblank line puts the buffer in Lisp mode and enables Auto-Fill mode:
</p>
<div class="example">
<pre class="example-preformatted">; -*- mode: Lisp; eval: (auto-fill-mode 1); -*-
</pre></div>

<p>Note, however, that it is usually inappropriate to enable minor modes
this way, since most minor modes represent individual user
preferences.  If you personally want to use a minor mode for a
particular file type, it is better to enable the minor mode via a
major mode hook (see <a class="pxref" href="Major-Modes.html">Major Modes</a>).
</p>
<p>Second, Emacs checks whether the file&rsquo;s extension matches an entry
in any directory-local <code class="code">auto-mode-alist</code>.  These are found using
the <samp class="file">.dir-locals.el</samp> facility (see <a class="pxref" href="Directory-Variables.html">Per-Directory Local Variables</a>).
</p>
<a class="index-entry-id" id="index-interpreter_002dmode_002dalist"></a>
<p>Third, if there is no file variable specifying a major mode, Emacs
checks whether the file&rsquo;s contents begin with &lsquo;<samp class="samp">#!</samp>&rsquo;.  If so, that
indicates that the file can serve as an executable shell command,
which works by running an interpreter named on the file&rsquo;s first line
(the rest of the file is used as input to the interpreter).
Therefore, Emacs tries to use the interpreter name to choose a mode.
For instance, a file that begins with &lsquo;<samp class="samp">#!/usr/bin/perl</samp>&rsquo; is opened
in Perl mode.  The variable <code class="code">interpreter-mode-alist</code> specifies
the correspondence between interpreter program names and major modes.
</p>
<p>When the first line starts with &lsquo;<samp class="samp">#!</samp>&rsquo;, you usually cannot use
the &lsquo;<samp class="samp">-*-</samp>&rsquo; feature on the first line, because the system would get
confused when running the interpreter.  So Emacs looks for &lsquo;<samp class="samp">-*-</samp>&rsquo;
on the second line in such files as well as on the first line.  The
same is true for man pages which start with the magic string
&lsquo;<samp class="samp">'\&quot;</samp>&rsquo; to specify a list of troff preprocessors.
</p>
<a class="index-entry-id" id="index-magic_002dmode_002dalist"></a>
<p>Fourth, Emacs tries to determine the major mode by looking at the
text at the start of the buffer, based on the variable
<code class="code">magic-mode-alist</code>.  By default, this variable is <code class="code">nil</code> (an
empty list), so Emacs skips this step; however, you can customize it
in your init file (see <a class="pxref" href="Init-File.html">The Emacs Initialization File</a>).  The value should be a list of
elements of the form
</p>
<div class="example">
<pre class="example-preformatted">(<var class="var">regexp</var> . <var class="var">mode-function</var>)
</pre></div>

<p>where <var class="var">regexp</var> is a regular expression (see <a class="pxref" href="Regexps.html">Syntax of Regular Expressions</a>), and
<var class="var">mode-function</var> is a major mode command.  If the text at the
beginning of the file matches <var class="var">regexp</var>, Emacs chooses the major
mode specified by <var class="var">mode-function</var>.
</p>
<p>Alternatively, an element of <code class="code">magic-mode-alist</code> may have the form
</p>
<div class="example">
<pre class="example-preformatted">(<var class="var">match-function</var> . <var class="var">mode-function</var>)
</pre></div>

<p>where <var class="var">match-function</var> is a Lisp function that is called at the
beginning of the buffer; if the function returns non-<code class="code">nil</code>, Emacs
set the major mode with <var class="var">mode-function</var>.
</p>
<p>Fifth&mdash;if Emacs still hasn&rsquo;t found a suitable major mode&mdash;it
looks at the file&rsquo;s name.  The correspondence between file names and
major modes is controlled by the variable <code class="code">auto-mode-alist</code>.  Its
value is a list in which each element has this form,
</p>
<div class="example">
<pre class="example-preformatted">(<var class="var">regexp</var> . <var class="var">mode-function</var>)
</pre></div>

<p>or this form,
</p>
<div class="example">
<pre class="example-preformatted">(<var class="var">regexp</var> <var class="var">mode-function</var> <var class="var">flag</var>)
</pre></div>

<p>For example, one element normally found in the list has the form
<code class="code">(<code class="t">&quot;\\.c\\'&quot;</code> . c-mode)</code>, and it is responsible for selecting C
mode for files whose names end in <samp class="file">.c</samp>.  (Note that &lsquo;<samp class="samp">\\</samp>&rsquo; is
needed in Lisp syntax to include a &lsquo;<samp class="samp">\</samp>&rsquo; in the string, which must
be used to suppress the special meaning of &lsquo;<samp class="samp">.</samp>&rsquo; in regexps.)
</p>
<a class="index-entry-id" id="index-backup-files_002c-choosing-a-major-mode"></a>
<a class="index-entry-id" id="index-encrypted-files_002c-choosing-a-major-mode"></a>
<p>If the element has the form <code class="code">(<var class="var">regexp</var>&nbsp;<var class="var">mode-function</var>&nbsp;<var class="var">flag</var>)</code><!-- /@w --> and <var class="var">flag</var> is non-<code class="code">nil</code>, then after calling
<var class="var">mode-function</var> (if it is non-<code class="code">nil</code>), Emacs discards the
suffix that matched <var class="var">regexp</var> and searches the list again for
another match.  This &ldquo;recursive extension stripping&rdquo; is used for
files which have multiple extensions, and the &ldquo;outer&rdquo; extension
hides the &ldquo;inner&rdquo; one that actually specifies the right mode.  For
example, backup files and GPG-encrypted files with <samp class="file">.gpg</samp>
extension use this feature.
</p>
<a class="index-entry-id" id="index-auto_002dmode_002dcase_002dfold"></a>
<p>On GNU/Linux and other systems with case-sensitive file names, Emacs
performs a case-sensitive search through <code class="code">auto-mode-alist</code>; if
this search fails, it performs a second case-insensitive search
through the alist.  To suppress the second search, change the variable
<code class="code">auto-mode-case-fold</code> to <code class="code">nil</code>.  On systems with
case-insensitive file names, such as Microsoft Windows, Emacs performs
a single case-insensitive search through <code class="code">auto-mode-alist</code>.
</p>
<a class="index-entry-id" id="index-magic_002dfallback_002dmode_002dalist"></a>
<p>Finally, if Emacs <em class="emph">still</em> hasn&rsquo;t found a major mode to use, it
compares the text at the start of the buffer to the variable
<code class="code">magic-fallback-mode-alist</code>.  This variable works like
<code class="code">magic-mode-alist</code>, described above, except that it is consulted
only <em class="emph">after</em> <code class="code">auto-mode-alist</code>.  By default,
<code class="code">magic-fallback-mode-alist</code> contains forms that check for image
files, HTML/XML/SGML files, PostScript files, and Unix style Conf
files.
</p>
<a class="index-entry-id" id="index-major_002dmode_002dremap_002dalist"></a>
<p>Once a major mode is found, Emacs does a final check to see if the
mode has been remapped by <code class="code">major-mode-remap-alist</code>, in which case
it uses the remapped mode instead.  This is used when several
different major modes can be used for the same file type, so you can
specify which mode you prefer.
</p>
<a class="index-entry-id" id="index-normal_002dmode"></a>
<p>If you have changed the major mode of a buffer, you can return to
the major mode Emacs would have chosen automatically, by typing
<kbd class="kbd">M-x normal-mode</kbd>.  This is the same function that
<code class="code">find-file</code> calls to choose the major mode.  If the buffer is
visiting a file, this command also processes the file&rsquo;s &lsquo;<samp class="samp">-*-</samp>&rsquo;
line and file-local variables list (if any).  See <a class="xref" href="File-Variables.html">Local Variables in Files</a>.
If the buffer doesn&rsquo;t visit a file, the command processes only the
major mode specification, if any, in the &lsquo;<samp class="samp">-*-</samp>&rsquo; line and in the
file-local variables list.
</p>
<a class="index-entry-id" id="index-change_002dmajor_002dmode_002dwith_002dfile_002dname"></a>
<p>The commands <kbd class="kbd">C-x C-w</kbd> and <code class="code">set-visited-file-name</code> change to
a new major mode if the new file name implies a mode (see <a class="pxref" href="Saving.html">Saving Files</a>).
(<kbd class="kbd">C-x C-s</kbd> does this too, if the buffer wasn&rsquo;t visiting a file.)
However, this does not happen if the buffer contents specify a major
mode, and certain special major modes do not allow the mode to
change.  You can turn off this mode-changing feature by setting
<code class="code">change-major-mode-with-file-name</code> to <code class="code">nil</code>.
</p></div>
<hr>
<div class="nav-panel">
<p>
Previous: <a href="Minor-Modes.html">Minor Modes</a>, Up: <a href="Modes.html">Major and Minor Modes</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Key-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
